<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="whidth=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Confira o Prato Elite</title>

  <meta name="theme-color" content="#10b981" />
  <meta name="description" content="Cadastro + Dieta + Treino semanal + Loja + Parceiros + Premium + Convites." />

  <!-- PWA (se voc√™ j√° tem esses arquivos no repo, vai funcionar) -->
  <link rel="manifest" href="./manifest.json" />
  <link rel="icon" href="./icon-192.png" />

  <style>
    :root{
      --bg:#050816;
      --stroke:#1a2a4b;
      --text:#e8edf7;
      --muted:#98a2b3;
      --green:#19d18a;
      --green2:#10b981;
      --gold:#f5c542;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(1200px 800px at 20% 10%, rgba(25,209,138,.18), transparent 60%),
                  radial-gradient(800px 600px at 85% 15%, rgba(109,99,255,.18), transparent 55%),
                  radial-gradient(900px 800px at 50% 90%, rgba(16,185,129,.10), transparent 60%),
                  var(--bg);
      color:var(--text);
      min-height:100vh;
      -webkit-tap-highlight-color: transparent;
    }
    .wrap{max-width:430px; margin:0 auto; min-height:100vh; padding:18px 16px 92px;}
    .brand{display:flex; align-items:center; gap:12px; margin:10px 0 14px;}
    .logo{
      width:44px; height:44px; border-radius:14px;
      background: linear-gradient(145deg, rgba(109,99,255,.9), rgba(25,209,138,.75));
      display:flex; align-items:center; justify-content:center;
      font-weight:900;
      box-shadow: 0 0 18px rgba(109,99,255,.18);
    }
    .brand h1{
      margin:0; font-size:20px; letter-spacing:.6px; font-weight:900;
      background: linear-gradient(90deg, var(--green), #44f2c2);
      -webkit-background-clip:text; background-clip:text; color:transparent;
      text-transform:uppercase;
      line-height:1.1;
    }
    .hint{margin-top:6px; font-size:12px; color:rgba(232,237,247,.65); line-height:1.35;}
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border:1px solid rgba(26,42,75,.9);
      border-radius:22px;
      padding:16px;
      box-shadow: 0 18px 50px rgba(0,0,0,.35);
    }
    label{display:block; font-size:12px; letter-spacing:.6px; color:rgba(232,237,247,.7); margin:12px 0 8px; text-transform:uppercase;}
    input, select{
      width:100%; padding:14px 14px; border-radius:16px;
      border:1px solid rgba(26,42,75,.9);
      background: rgba(3,8,20,.55);
      color:var(--text);
      outline:none;
    }
    input::placeholder{color:rgba(152,162,179,.75);}
    .row{display:flex; gap:10px;}
    .row>div{flex:1;}
    .btn{
      width:100%; border:0; border-radius:18px; padding:16px 14px;
      font-weight:900; letter-spacing:.7px; text-transform:uppercase;
      margin-top:14px;
      background: linear-gradient(90deg, rgba(25,209,138,.98), rgba(16,185,129,.88));
      color:#04110c;
      box-shadow: 0 18px 40px rgba(16,185,129,.16);
      cursor:pointer;
    }
    .btn.secondary{
      background: rgba(255,255,255,.03);
      color: var(--text);
      border:1px solid rgba(26,42,75,.9);
      box-shadow:none;
    }
    .status{margin-top:10px; font-size:13px; color:rgba(232,237,247,.9);}
    .check{
      display:flex; gap:10px; align-items:flex-start;
      padding:12px; border-radius:16px;
      border:1px solid rgba(26,42,75,.9);
      background: rgba(3,8,20,.55);
      margin-top:12px;
    }
    .check input{width:auto; margin-top:2px;}

    .screen{display:none;}
    .screen.active{display:block;}

    .nav{
      position:fixed; left:0; right:0; bottom:0;
      background: rgba(3,8,20,.85);
      border-top:1px solid rgba(26,42,75,.9);
      backdrop-filter: blur(10px);
      padding:10px 12px calc(12px + env(safe-area-inset-bottom));
    }
    .navInner{
      max-width:430px; margin:0 auto;
      display:flex; gap:8px; align-items:center; justify-content:space-between;
      border-radius:22px; padding:10px 12px;
      background: rgba(255,255,255,.03);
      border:1px solid rgba(26,42,75,.9);
      overflow-x:auto;
    }
    .navBtn{
      min-width:86px;
      height:44px; border-radius:16px;
      border:0; background:transparent; color:rgba(232,237,247,.55);
      font-weight:900; cursor:pointer;
      white-space:nowrap;
    }
    .navBtn.active{
      color: var(--green);
      background: rgba(25,209,138,.10);
      border:1px solid rgba(25,209,138,.28);
    }

    /* Foto */
    .profileRow{
      display:flex; gap:12px; align-items:center; margin-top:10px;
      padding:12px; border-radius:18px;
      border:1px solid rgba(26,42,75,.9);
      background: rgba(3,8,20,.55);
    }
    .avatar{
      width:72px; height:72px; border-radius:18px;
      border:1px solid rgba(26,42,75,.9);
      background: rgba(255,255,255,.03);
      overflow:hidden; display:flex; align-items:center; justify-content:center;
      font-weight:1000; color:rgba(232,237,247,.7);
      flex-shrink:0;
    }
    .avatar img{width:100%; height:100%; object-fit:cover;}
    .miniBtn{
      padding:10px 12px; border-radius:14px;
      border:1px solid rgba(26,42,75,.9);
      background: rgba(255,255,255,.03);
      color:var(--text); font-weight:900; cursor:pointer;
      width:100%;
    }
    .miniBtn.green{
      background: rgba(25,209,138,.10);
      border:1px solid rgba(25,209,138,.28);
      color: var(--green);
    }

    /* Esportes */
    .chips{
      display:flex; flex-wrap:wrap; gap:8px;
      padding:12px; border-radius:18px;
      border:1px solid rgba(26,42,75,.9);
      background: rgba(3,8,20,.55);
    }
    .chip{
      padding:10px 12px; border-radius:999px;
      border:1px solid rgba(26,42,75,.9);
      background: rgba(255,255,255,.03);
      color: rgba(232,237,247,.8);
      font-weight:900; cursor:pointer; user-select:none;
    }
    .chip.active{
      background: rgba(25,209,138,.14);
      border:1px solid rgba(25,209,138,.30);
      color: var(--green);
    }

    /* Treino cards */
    .dayCard{
      margin-top:12px;
      padding:14px;
      border-radius:20px;
      border:1px solid rgba(26,42,75,.9);
      background: rgba(3,8,20,.55);
    }
    .dayTitle{
      font-weight:1000; letter-spacing:.6px; margin-bottom:8px;
      display:flex; justify-content:space-between; align-items:center;
    }
    .exercise{
      display:flex; justify-content:space-between; align-items:center;
      gap:10px;
      padding:10px 10px; border-radius:14px;
      border:1px solid rgba(26,42,75,.9);
      background: rgba(255,255,255,.03);
      margin-top:8px;
    }
    .exercise b{font-size:13px;}
    .ytBtn{
      padding:10px 12px; border-radius:14px;
      border:1px solid rgba(25,209,138,.28);
      background: rgba(25,209,138,.10);
      color: var(--green);
      font-weight:1000;
      cursor:pointer;
      white-space:nowrap;
    }

    /* Loja */
    .shopGrid{display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-top:12px;}
    .shopItem{
      padding:14px; border-radius:20px;
      border:1px solid rgba(26,42,75,.9);
      background: rgba(3,8,20,.55);
    }
    .shopItem h3{margin:0 0 6px; font-size:14px; letter-spacing:.4px;}
    .shopItem p{margin:0 0 10px; font-size:12px; color:rgba(232,237,247,.7); line-height:1.3;}
    .shopItem button{
      width:100%;
      padding:12px 10px;
      border-radius:16px;
      border:1px solid rgba(26,42,75,.9);
      background: rgba(255,255,255,.03);
      color:var(--text);
      font-weight:1000;
      cursor:pointer;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="brand">
      <div class="logo">E</div>
      <div>
        <h1>Confira o Prato Elite</h1>
        <div class="hint">Cadastro ‚Ä¢ Dieta ‚Ä¢ Treino semanal ‚Ä¢ Loja ‚Ä¢ Parceiros ‚Ä¢ Premium ‚Ä¢ Convites</div>
      </div>
    </div>

    <!-- CADASTRO -->
    <section id="viewCadastro" class="screen active">
      <div class="card">
        <div style="font-weight:1000; letter-spacing:.6px;">CADASTRO & SA√öDE</div>
        <div class="hint">As sugest√µes s√£o informativas e n√£o substituem profissional.</div>

        <label>Foto de perfil</label>
        <div class="profileRow">
          <div class="avatar" id="avatar"><span>FOTO</span></div>
          <div style="flex:1;">
            <button class="miniBtn green" onclick="abrirEscolhaFoto()">Escolher/Tirar Foto</button>
            <button class="miniBtn" onclick="removerFoto()" style="margin-top:8px;">Remover foto</button>
          </div>
        </div>

        <input id="fotoFile" type="file" accept="image/*" style="display:none;">
        <input id="fotoCamera" type="file" accept="image/*" capture="environment" style="display:none;">

        <label>Nome / Codinome</label>
        <input id="nome" placeholder="Ex: Jonatan" />

        <div class="row">
          <div>
            <label>Idade</label>
            <input id="idade" type="number" placeholder="Ex: 28" />
          </div>
          <div>
            <label>Sexo</label>
            <select id="sexo">
              <option value="">Selecione</option>
              <option>Masculino</option>
              <option>Feminino</option>
              <option>Outro</option>
            </select>
          </div>
        </div>

        <div class="row">
          <div>
            <label>Peso (kg)</label>
            <input id="peso" type="number" step="0.1" placeholder="Ex: 78.5" />
          </div>
          <div>
            <label>Altura (cm)</label>
            <input id="altura" type="number" placeholder="Ex: 175" />
          </div>
        </div>

        <label>Objetivo</label>
        <select id="objetivo">
          <option value="">Selecione</option>
          <option>Emagrecer</option>
          <option>Ganhar massa</option>
          <option>Manter peso</option>
          <option>Melhorar sa√∫de</option>
        </select>

        <div class="row">
          <div>
            <label>N√≠vel</label>
            <select id="nivel">
              <option value="">Selecione</option>
              <option>Iniciante</option>
              <option>Intermedi√°rio</option>
              <option>Avan√ßado</option>
            </select>
          </div>
          <div>
            <label>Condi√ß√£o</label>
            <select id="condicao">
              <option value="">Selecione</option>
              <option>Nenhuma</option>
              <option>Diabetes</option>
              <option>Press√£o alta</option>
            </select>
          </div>
        </div>

        <label>Restri√ß√£o</label>
        <select id="restricao">
          <option value="">Selecione</option>
          <option>Nenhuma</option>
          <option>Vegetariano</option>
          <option>Vegano</option>
          <option>Intoler√¢ncia √† lactose</option>
          <option>Gl√∫ten</option>
        </select>

        <label>Esportes (pode marcar v√°rios)</label>
        <div class="chips" id="chipsEsportes"></div>

        <div class="check">
          <input id="termo" type="checkbox" />
          <div>
            <div style="font-weight:900;">Aceito o termo</div>
            <div class="hint" style="margin:4px 0 0;">As sugest√µes s√£o informativas.</div>
          </div>
        </div>

        <button class="btn" onclick="salvarPerfil()">Salvar / Atualizar</button>
        <button class="btn secondary" onclick="limparPerfil()">Limpar</button>

        <div id="statusCadastro" class="status"></div>
      </div>
    </section>

    <!-- DIETA -->
    <section id="viewDieta" class="screen">
      <div class="card">
        <div style="font-weight:1000; letter-spacing:.6px;">DIETA (F√ÅCIL)</div>
        <div class="hint">Sugest√µes r√°pidas baseadas no seu perfil.</div>
        <button class="btn" onclick="gerarDieta()">Gerar dieta</button>
        <button class="btn secondary" onclick="gerarDieta(true)">Nova dieta</button>
        <div id="outDieta" class="status"></div>
      </div>
    </section>

    <!-- TREINO -->
    <section id="viewTreino" class="screen">
      <div class="card">
        <div style="font-weight:1000; letter-spacing:.6px;">TREINO DA SEMANA</div>
        <div class="hint">Cada exerc√≠cio tem bot√£o pro YouTube.</div>
        <button class="btn" onclick="gerarTreinoSemana()">Gerar treino da semana</button>
        <button class="btn secondary" onclick="limparTreino()">Limpar treino</button>
        <div id="outTreino" class="status"></div>
        <div id="treinoSemana"></div>
      </div>
    </section>

    <!-- LOJA -->
    <section id="viewLoja" class="screen">
      <div class="card">
        <div style="font-weight:1000; letter-spacing:.6px;">LOJA</div>
        <div class="hint">Depois voc√™ troca pelos seus links de afiliado.</div>

        <div class="shopGrid">
          <div class="shopItem">
            <h3>Suplementos</h3>
            <p>Whey, creatina, vitaminas.</p>
            <button onclick="abrirLink('https://www.gsuplementos.com.br')">Abrir</button>
          </div>
          <div class="shopItem">
            <h3>Roupas fitness</h3>
            <p>T√™nis, camisetas, shorts.</p>
            <button onclick="abrirLink('https://www.nike.com.br')">Abrir</button>
          </div>
          <div class="shopItem">
            <h3>Acess√≥rios</h3>
            <p>Luvas, garrafas, straps.</p>
            <button onclick="abrirLink('https://www.amazon.com.br')">Abrir</button>
          </div>
          <div class="shopItem">
            <h3>Marketplace</h3>
            <p>Pre√ßos variados.</p>
            <button onclick="abrirLink('https://www.mercadolivre.com.br')">Abrir</button>
          </div>
        </div>
      </div>
    </section>

    <!-- PARCEIROS -->
    <section id="viewParceiros" class="screen">
      <div class="card">
        <div style="font-weight:1000; letter-spacing:.6px;">PARCEIROS</div>
        <div class="hint">Em breve: parceiros perto de voc√™ (com localiza√ß√£o opcional).</div>
        <button class="btn" onclick="simularParceiros()">Ver parceiros (simula√ß√£o)</button>
        <div id="outParceiros" class="status"></div>
      </div>
    </section>

    <!-- PREMIUM -->
    <section id="viewPremium" class="screen">
      <div class="card">
        <div style="font-weight:1000; letter-spacing:.6px; color:var(--gold);">ASSINATURA ELITE</div>
        <div class="hint">
          R$ 29,90/m√™s ‚Ä¢ Benef√≠cios Premium.
          <br><br><b>Pagamento no Mercado Pago (checkout)</b>. N√£o coletamos dados do seu cart√£o aqui.
        </div>

        <button id="btnPremium" class="btn"
          style="background:linear-gradient(90deg,#f5c542,#f0b429); color:#1b1404;"
          onclick="openCheckout()">
          CONFIRMAR R$ 29,90/M√äS
        </button>

        <div class="hint" style="margin-top:10px; text-align:center; opacity:.7;">
          AMBIENTE SEGURO ‚Ä¢ SSL
        </div>
      </div>
    </section>

    <!-- CONVITES -->
    <section id="viewConvites" class="screen">
      <div class="card">
        <div style="font-weight:1000; letter-spacing:.6px;">CONVITES</div>
        <div class="hint">
          Convide amigos com seu link.
          <br>‚Ä¢ Voc√™ ganha <b>R$ 5,00</b> por cada assinatura Premium confirmada
          <br>‚Ä¢ Saque m√≠nimo: <b>R$ 50,00</b> via Pix (mais pra frente)
          <br>‚Ä¢ Ao bater 10 assinaturas confirmadas: <b>1 m√™s gr√°tis</b>
          <br><br><span style="opacity:.75;">(Saldo aqui √© ‚Äúsimulado‚Äù at√© ligarmos Firebase + confirma√ß√£o autom√°tica.)</span>
        </div>

        <div class="dayCard" style="margin-top:12px;">
          <div class="dayTitle"><span>Seu c√≥digo</span><span id="myCode" style="opacity:.8;"></span></div>
          <div class="hint" id="myLink" style="word-break:break-all;"></div>

          <div style="display:flex; gap:10px; margin-top:10px;">
            <button class="miniBtn green" onclick="shareInvite()">Compartilhar</button>
            <button class="miniBtn" onclick="copyInviteLink()">Copiar link</button>
          </div>
        </div>

        <div class="dayCard">
          <div class="dayTitle"><span>Saldo</span><span id="balTxt" style="opacity:.8;"></span></div>
          <div class="hint" id="progressTxt"></div>

          <!-- bot√µes de teste (pode remover depois) -->
          <div style="display:flex; gap:10px; margin-top:10px;">
            <button class="miniBtn" onclick="setBalance(getBalance()+5)">+R$5 (teste)</button>
            <button class="miniBtn" onclick="setBalance(0)">Zerar</button>
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- NAV -->
  <div class="nav">
    <div class="navInner">
      <button class="navBtn active" data-view="cadastro">CADASTRO</button>
      <button class="navBtn" data-view="dieta">DIETA</button>
      <button class="navBtn" data-view="treino">TREINO</button>
      <button class="navBtn" data-view="loja">LOJA</button>
      <button class="navBtn" data-view="parceiros">PARCEIROS</button>
      <button class="navBtn" data-view="premium">PREMIUM</button>
      <button class="navBtn" data-view="convites">CONVITES</button>
    </div>
  </div>

  <script>
    // ====== PWA (se existir service-worker.js no repo) ======
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("./service-worker.js").catch(()=>{});
    }

    // ====== COLE AQUI O LINK DO MERCADO PAGO ======
    const PREMIUM_PRICE = 29.90;
    const PREMIUM_CHECKOUT_URL = "https://mpago.la/2BRjpaP"; // ex: https://mpago.la/xxxxxx

    // ====== STORAGE KEYS ======
    const KEY = "checkprato_perfil_v3";
    const KEY_TREINO = "checkprato_treino_semana_v1";
    const KEY_REF = "checkprato_ref_code";
    const KEY_MY_CODE = "checkprato_my_invite_code";
    const KEY_BAL = "checkprato_invite_balance";

    const ESPORTES = [
      "Muscula√ß√£o","Futebol","Corrida","Crossfit","Ciclismo","Nata√ß√£o",
      "Luta","Basquete","V√¥lei","Yoga","Pilates","Caminhada"
    ];

    const $ = (id) => document.getElementById(id);

    function getPerfil(){ try{return JSON.parse(localStorage.getItem(KEY)||"null");}catch{return null;} }
    function setPerfil(p){ localStorage.setItem(KEY, JSON.stringify(p)); }

    function getTreino(){ try{return JSON.parse(localStorage.getItem(KEY_TREINO)||"null");}catch{return null;} }
    function setTreino(t){ localStorage.setItem(KEY_TREINO, JSON.stringify(t)); }

    // ====== NAV ======
    function switchView(view){
      ["viewCadastro","viewDieta","viewTreino","viewLoja","viewParceiros","viewPremium","viewConvites"]
        .forEach(id => $(id).classList.remove("active"));

      if(view==="cadastro") $("viewCadastro").classList.add("active");
      if(view==="dieta") $("viewDieta").classList.add("active");
      if(view==="treino") $("viewTreino").classList.add("active");
      if(view==="loja") $("viewLoja").classList.add("active");
      if(view==="parceiros") $("viewParceiros").classList.add("active");
      if(view==="premium") $("viewPremium").classList.add("active");
      if(view==="convites") $("viewConvites").classList.add("active");

      document.querySelectorAll(".navBtn").forEach(b=>b.classList.remove("active"));
      document.querySelector(`.navBtn[data-view="${view}"]`)?.classList.add("active");
    }
    document.querySelectorAll(".navBtn").forEach(btn=>{
      btn.addEventListener("click", ()=> switchView(btn.dataset.view));
    });

    // ====== FOTO (galeria + c√¢mera) ======
    function abrirEscolhaFoto(){
      const usarCamera = confirm("Quer tirar foto agora?\nOK = C√¢mera | Cancelar = Galeria");
      if(usarCamera) $("fotoCamera").click();
      else $("fotoFile").click();
    }
    window.abrirEscolhaFoto = abrirEscolhaFoto;

    $("fotoFile").addEventListener("change", (e)=> handleFoto(e.target.files?.[0]));
    $("fotoCamera").addEventListener("change", (e)=> handleFoto(e.target.files?.[0]));

    async function handleFoto(file){
      if(!file) return;
      const dataUrl = await compressImageToDataURL(file, 420, 0.82);
      const p = getPerfil() || {};
      p.fotoDataUrl = dataUrl;
      setPerfil(p);
      renderFoto(dataUrl);
      $("statusCadastro").textContent = "‚úÖ Foto salva!";
    }

    function removerFoto(){
      const p = getPerfil() || {};
      delete p.fotoDataUrl;
      setPerfil(p);
      renderFoto(null);
      $("statusCadastro").textContent = "üßπ Foto removida.";
    }
    window.removerFoto = removerFoto;

    function renderFoto(dataUrl){
      const avatar = $("avatar");
      avatar.innerHTML = "";
      if(!dataUrl){ avatar.innerHTML = "<span>FOTO</span>"; return; }
      const img = document.createElement("img");
      img.src = dataUrl;
      avatar.appendChild(img);
    }

    function compressImageToDataURL(file, maxSize, quality){
      return new Promise((resolve) => {
        const img = new Image();
        const reader = new FileReader();
        reader.onload = () => { img.src = reader.result; };
        reader.readAsDataURL(file);

        img.onload = () => {
          const scale = Math.min(1, maxSize / Math.max(img.width, img.height));
          const w = Math.round(img.width * scale);
          const h = Math.round(img.height * scale);

          const canvas = document.createElement("canvas");
          canvas.width = w; canvas.height = h;
          const ctx = canvas.getContext("2d");
          ctx.drawImage(img, 0, 0, w, h);
          resolve(canvas.toDataURL("image/jpeg", quality));
        };
        img.onerror = () => resolve(null);
      });
    }

    // ====== ESPORTES ======
    let selectedSports = new Set();
    function buildSportsChips(){
      const box = $("chipsEsportes");
      box.innerHTML = "";
      ESPORTES.forEach((name)=>{
        const chip = document.createElement("div");
        chip.className = "chip";
        chip.textContent = name;
        chip.addEventListener("click", ()=>{
          if(selectedSports.has(name)) selectedSports.delete(name);
          else selectedSports.add(name);
          chip.classList.toggle("active", selectedSports.has(name));
        });
        box.appendChild(chip);
      });
    }
    function applySelectedSportsToUI(){
      const chips = [...document.querySelectorAll("#chipsEsportes .chip")];
      chips.forEach((c)=> c.classList.toggle("active", selectedSports.has(c.textContent)));
    }

    // ====== PERFIL ======
    function salvarPerfil(){
      if(!$("termo").checked){
        $("statusCadastro").textContent = "‚ö†Ô∏è Aceite o termo para salvar.";
        return;
      }
      const old = getPerfil() || {};
      const perfil = {
        ...old,
        nome: $("nome").value.trim(),
        idade: Number($("idade").value),
        sexo: $("sexo").value,
        peso: Number($("peso").value),
        altura: Number($("altura").value),
        objetivo: $("objetivo").value,
        nivel: $("nivel").value,
        restricao: $("restricao").value,
        condicao: $("condicao").value,
        esportes: Array.from(selectedSports)
      };

      if(!perfil.nome || !perfil.idade || !perfil.peso || !perfil.altura || !perfil.objetivo){
        $("statusCadastro").textContent = "‚ö†Ô∏è Preencha: Nome, Idade, Peso, Altura e Objetivo.";
        return;
      }
      if(perfil.esportes.length === 0){
        $("statusCadastro").textContent = "‚ö†Ô∏è Marque pelo menos 1 esporte.";
        return;
      }

      setPerfil(perfil);
      $("statusCadastro").textContent = "‚úÖ Perfil salvo!";
    }
    window.salvarPerfil = salvarPerfil;

    function limparPerfil(){
      localStorage.removeItem(KEY);
      localStorage.removeItem(KEY_TREINO);
      selectedSports = new Set();
      applySelectedSportsToUI();
      renderFoto(null);
      $("statusCadastro").textContent = "üßπ Perfil apagado.";
      $("treinoSemana").innerHTML = "";
      $("outTreino").textContent = "";
    }
    window.limparPerfil = limparPerfil;

    function carregarPerfilNaTela(){
      const p = getPerfil();
      if(!p) return;
      renderFoto(p.fotoDataUrl || null);
      $("nome").value = p.nome || "";
      $("idade").value = p.idade || "";
      $("sexo").value = p.sexo || "";
      $("peso").value = p.peso || "";
      $("altura").value = p.altura || "";
      $("objetivo").value = p.objetivo || "";
      $("nivel").value = p.nivel || "";
      $("restricao").value = p.restricao || "";
      $("condicao").value = p.condicao || "";
      $("termo").checked = true;
      selectedSports = new Set(p.esportes || []);
      applySelectedSportsToUI();
    }

    // ====== DIETA ======
    function gerarDieta(nova=false){
      const p = getPerfil();
      if(!p){ $("outDieta").textContent = "‚ö†Ô∏è Fa√ßa o cadastro primeiro."; return; }

      const dietas = {
        "Emagrecer": [
          "Caf√©: 2 ovos + banana | Almo√ßo: frango + salada | Jantar: omelete + legumes",
          "Caf√©: iogurte + aveia | Almo√ßo: carne magra + arroz integral | Jantar: sopa de legumes",
          "Caf√©: tapioca + queijo | Almo√ßo: peixe/frango + legumes | Jantar: salada com prote√≠na"
        ],
        "Ganhar massa": [
          "Caf√©: ovos + p√£o | Almo√ßo: arroz + feij√£o + carne | Jantar: macarr√£o + frango",
          "Caf√©: vitamina (banana+aveia) | Almo√ßo: frango + batata doce | Jantar: carne + arroz",
          "Caf√©: iogurte + granola | Almo√ßo: peixe + arroz | Jantar: omelete + batata"
        ],
        "Manter peso": [
          "Caf√©: fruta + ovos | Almo√ßo: prato equilibrado | Jantar: prote√≠na + legumes",
          "Caf√©: iogurte + fruta | Almo√ßo: arroz+feij√£o+carne | Jantar: salada + frango",
          "Caf√©: p√£o + queijo | Almo√ßo: macarr√£o + carne | Jantar: sopa leve"
        ],
        "Melhorar sa√∫de": [
          "Caf√©: frutas + aveia | Almo√ßo: frango/peixe + salada | Jantar: legumes + ovos",
          "Caf√©: iogurte natural | Almo√ßo: arroz integral + feij√£o + salada | Jantar: sopa de legumes",
          "Caf√©: p√£o integral + ovos | Almo√ßo: prote√≠na magra + legumes | Jantar: salada refor√ßada"
        ]
      };

      let lista = dietas[p.objetivo] || dietas["Melhorar sa√∫de"];
      let escolha = lista[Math.floor(Math.random() * lista.length)];

      if(p.restricao === "Vegetariano" || p.restricao === "Vegano"){
        escolha = escolha
          .replace(/frango|carne|peixe/gi, "gr√£o-de-bico/tofu")
          .replace(/ovos/gi, p.restricao === "Vegano" ? "tofu" : "ovos");
      }
      if(p.restricao === "Intoler√¢ncia √† lactose"){
        escolha = escolha.replace(/iogurte|queijo/gi, "iogurte/queijo sem lactose");
      }
      if(p.restricao === "Gl√∫ten"){
        escolha = escolha.replace(/p√£o|macarr√£o/gi, "op√ß√£o sem gl√∫ten");
      }

      let aviso = "";
      if(p.condicao === "Diabetes") aviso += " ‚ö†Ô∏è Aten√ß√£o com carboidratos e a√ß√∫car.";
      if(p.condicao === "Press√£o alta") aviso += " ‚ö†Ô∏è Reduzir s√≥dio (sal/embutidos).";

      $("outDieta").textContent = `${nova ? "üîÅ " : ""}${escolha}${aviso}`;
    }
    window.gerarDieta = gerarDieta;

    // ====== TREINO ======
    function gerarTreinoSemana(){
      const p = getPerfil();
      if(!p){ $("outTreino").textContent = "‚ö†Ô∏è Fa√ßa o cadastro primeiro."; return; }
      const nivel = p.nivel || "Iniciante";
      const tema = (p.esportes && p.esportes.length) ? p.esportes[0] : "Muscula√ß√£o";

      const dias = ["Segunda","Ter√ßa","Quarta","Quinta","Sexta","S√°bado","Domingo"];
      const base = [
        "Agachamento", "Supino", "Remada", "Prancha",
        "Flex√£o", "Abdominal", "Desenvolvimento", "Panturrilha"
      ];

      const rotina = dias.map((dia, idx)=>{
        const itens = (idx===3 || idx===6)
          ? ["Descanso / Alongamento 15min"]
          : [base[idx%base.length], base[(idx+2)%base.length], base[(idx+4)%base.length]];
        return { dia, bloco: (idx===3||idx===6) ? "DESC" : (idx%2===0?"A":"B"), itens };
      });

      const plano = { tema, nivel, rotina, createdAt: Date.now() };
      setTreino(plano);
      $("outTreino").textContent = `‚úÖ Treino gerado: ${tema} (${nivel})`;
      renderTreinoSemana(plano);
    }
    window.gerarTreinoSemana = gerarTreinoSemana;

    function renderTreinoSemana(plano){
      const box = $("treinoSemana");
      box.innerHTML = "";
      plano.rotina.forEach((d)=>{
        const day = document.createElement("div");
        day.className = "dayCard";
        day.innerHTML = `<div class="dayTitle"><span>${d.dia}</span><span style="opacity:.75;font-weight:1000;">${d.bloco}</span></div>`;
        d.itens.forEach((ex)=>{
          const row = document.createElement("div");
          row.className = "exercise";
          const left = document.createElement("div");
          left.innerHTML = `<b>${escapeHtml(ex)}</b><div style="font-size:12px;opacity:.7;">Ver t√©cnica no YouTube</div>`;
          const btn = document.createElement("button");
          btn.className = "ytBtn";
          btn.textContent = "YouTube";
          btn.addEventListener("click", ()=>{
            const q = encodeURIComponent(ex + " como fazer");
            window.open(`https://www.youtube.com/results?search_query=${q}`, "_blank");
          });
          row.appendChild(left);
          row.appendChild(btn);
          day.appendChild(row);
        });
        box.appendChild(day);
      });
    }

    function limparTreino(){
      localStorage.removeItem(KEY_TREINO);
      $("treinoSemana").innerHTML = "";
      $("outTreino").textContent = "üßπ Treino removido.";
    }
    window.limparTreino = limparTreino;

    // ====== LOJA/PARCEIROS ======
    function abrirLink(url){ window.open(url, "_blank"); }
    window.abrirLink = abrirLink;

    function simularParceiros(){
      $("outParceiros").innerHTML =
        "üìç Exemplo (simula√ß√£o):<br>‚Ä¢ Academia Elite Center (2,1 km)<br>‚Ä¢ Loja Fit Suplementos (3,4 km)";
    }
    window.simularParceiros = simularParceiros;
    
      }
      window.open(PREMIUM_CHECKOUT_URL, "_blank");
    }
    window.openCheckout = openCheckout;

    // ====== CONVITES ======
    function captureReferralFromURL(){
      const url = new URL(window.location.href);
      const ref = url.searchParams.get("ref");
      if(ref && ref.length >= 4){
        localStorage.setItem(KEY_REF, ref.toUpperCase());
      }
    }
    captureReferralFromURL();

    function getOrCreateInviteCode(){
      let code = localStorage.getItem(KEY_MY_CODE);
      if(!code){
        code = Math.random().toString(36).slice(2, 8).toUpperCase();
        localStorage.setItem(KEY_MY_CODE, code);
      }
      return code;
    }
    function getMyInviteLink(){
      const code = getOrCreateInviteCode();
      const base = window.location.origin + window.location.pathname;
      return `${base}?ref=${encodeURIComponent(code)}`;
    }
    async function copyInviteLink(){
      const link = getMyInviteLink();
      try{
        await navigator.clipboard.writeText(link);
        alert("‚úÖ Link copiado!");
      } catch {
        prompt("Copie o link:", link);
      }
    }
    window.copyInviteLink = copyInviteLink;

    function shareInvite(){
      const link = getMyInviteLink();
      const text = `Baixa o Confira o Prato Elite e usa meu link: ${link}`;
      if(navigator.share){
        navigator.share({ title:"Confira o Prato Elite", text, url: link }).catch(()=>{});
      } else {
        copyInviteLink();
      }
    }
    window.shareInvite = shareInvite;

    function getBalance(){ return Number(localStorage.getItem(KEY_BAL) || "0"); }
    function setBalance(v){ localStorage.setItem(KEY_BAL, String(v)); renderInviteUI(); }
    window.getBalance = getBalance;
    window.setBalance = setBalance;

    function renderInviteUI(){
      const code = getOrCreateInviteCode();
      const link = getMyInviteLink();
      const bal = getBalance();
      const falta = Math.max(0, 50 - bal);

      $("myCode").textContent = code;
      $("myLink").textContent = link;

      $("balTxt").textContent = new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(bal);
      $("progressTxt").textContent = bal >= 50
        ? "‚úÖ Voc√™ atingiu R$ 50 (saque via Pix ser√° ativado quando ligarmos o sistema)."
        : `Faltam ${new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(falta)} para R$ 50,00.`;
    }

    function escapeHtml(s){
      return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
    }
    
 // ===== NAVEGA√á√ÉO ENTRE ABAS (FIX) =====
    function switchView(view){
  document.querySelectorAll(".screen").forEach(s => s.classList.remove("active"));
  document.querySelectorAll(".navBtn").forEach(b => b.classList.remove("active"));

  const map = {
    cadastro: "viewCadastro",
    dieta: "viewDieta",
    treino: "viewTreino",
    loja: "viewLoja",
    parceiros: "viewParceiros",
    premium: "viewPremium",
    convites: "viewConvites",
  };

  const targetId = map[view];
  if(targetId){
    const el = document.getElementById(targetId);
    if(el) el.classList.add("active");
  }

  const btn = document.querySelector(`.navBtn[data-view="${view}"]`);
  if(btn) btn.classList.add("active");
}

// ligar cliques do menu
document.querySelectorAll(".navBtn").forEach(btn=>{
  btn.addEventListener("click", ()=> switchView(btn.dataset.view));
});
}

// ligar clique dos bot√µes
 document.querySelectorAll(".navBtn").forEach(btn=>{
  btn.addEventListener("click", ()=>{
    switchView(btn.dataset.view);
  });
});// ===== PREMIUM / PAGAMENTO =====
 const PREMIUM_PRICE = 29.90;
 const PREMIUM_CHECKOUT_URL = "https://mpago.la/2BRjpaP";

 function openCheckout(){
  window.open(PREMIUM_CHECKOUT_URL, "_blank");
}
    // ====== INIT ======
    function init(){
      buildSportsChips();
      carregarPerfilNaTela();

      const t = getTreino();
      if(t){
        renderTreinoSemana(t);
        $("outTreino").textContent = `‚úÖ Treino salvo: ${t.tema} (${t.nivel})`;
      }

      // atualizar texto do bot√£o premium (fixo, mas ok)
      $("btnPremium").textContent = `CONFIRMAR R$ ${PREMIUM_PRICE.toFixed(2).replace(".", ",")}/M√äS`;

      renderInviteUI();
    }
  
    init();
  </script>
</body>
</html>
