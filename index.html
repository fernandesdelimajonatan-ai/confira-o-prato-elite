<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#0b1220" />
  <title>Confira o Prato Elite</title>

  <link rel="manifest" href="./manifest.json" />
  <link rel="icon" href="./icone-192.png" />

  <style>
    :root{
      --bg:#07101f; --stroke:rgba(255,255,255,.10);
      --text:#eaf1ff; --muted:rgba(234,241,255,.72);
      --green:#22e1a1; --green2:#12c98f; --yellow:#f0b429;
      --shadow: 0 12px 40px rgba(0,0,0,.45); --radius:20px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      background:
        radial-gradient(900px 420px at 20% -10%, rgba(34,225,161,.20), transparent 50%),
        radial-gradient(700px 360px at 90% 10%, rgba(46,120,255,.16), transparent 55%),
        linear-gradient(180deg, #060c18 0%, var(--bg) 40%, #050a14 100%);
      overflow-x:hidden;
    }
    .app{max-width:520px;margin:0 auto;min-height:100dvh;padding:18px 16px 90px;}
    .topbar{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:14px;}
    .brand{display:flex;align-items:center;gap:10px;font-weight:900;letter-spacing:.3px;}
    .logo{
      width:42px;height:42px;border-radius:14px;
      background: linear-gradient(135deg, rgba(34,225,161,.35), rgba(46,120,255,.18));
      border:1px solid var(--stroke); box-shadow: var(--shadow);
      display:grid;place-items:center;
    }
    .logo span{font-weight:1000;color:var(--green);font-size:18px;}
    .titleStack{line-height:1.1}
    .titleStack .t1{font-size:14px;color:var(--muted);font-weight:700}
    .titleStack .t2{font-size:18px;font-weight:1000}
    .pill{
      border:1px solid var(--stroke); background: rgba(255,255,255,.04);
      border-radius:999px;padding:10px 12px;color:var(--muted);
      font-weight:700;display:flex;align-items:center;gap:8px;
    }
    .pill b{color:var(--text)}
    .btn{
      width:100%; border:0; border-radius:18px; padding:16px;
      font-weight:1000; letter-spacing:.2px;
      background: linear-gradient(90deg, var(--green2), var(--green));
      color:#04140f; box-shadow: 0 14px 36px rgba(18,201,143,.25);
      cursor:pointer;
    }
    .btn:active{transform: translateY(1px)}
    .btn.secondary{
      background: rgba(255,255,255,.05); border:1px solid var(--stroke);
      color:var(--text); box-shadow:none;
    }
    .btn.yellow{
      background: linear-gradient(90deg, #f6c85a, var(--yellow));
      color:#1b1404; box-shadow: 0 14px 36px rgba(240,180,41,.22);
    }
    .h1{
      font-size:30px;font-weight:1000;margin:6px 0 14px;
      letter-spacing:.4px;color:var(--green);text-transform:uppercase;
    }
    .screen{display:none; animation:fade .18s ease}
    .screen.active{display:block}
    @keyframes fade{from{opacity:.35;transform:translateY(6px)}to{opacity:1;transform:none}}
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.03));
      border:1px solid var(--stroke); border-radius:var(--radius);
      box-shadow:var(--shadow); padding:16px; margin:14px 0;
    }
    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .field{display:flex;flex-direction:column;gap:8px}
    label{font-size:12px;letter-spacing:.9px;text-transform:uppercase;color:rgba(234,241,255,.65);font-weight:900}
    input, select{
      width:100%;border-radius:16px;padding:14px;border:1px solid var(--stroke);
      background: rgba(0,0,0,.18); color:var(--text); outline:none;
    }
    input::placeholder{color: rgba(234,241,255,.35)}
    .hint{color: rgba(234,241,255,.66); font-weight:650; font-size:13px; line-height:1.35}
    .chips{display:flex;flex-wrap:wrap;gap:10px;margin-top:8px;}
    .chip{
      border:1px solid var(--stroke); background: rgba(255,255,255,.05);
      color:var(--text); padding:10px 12px; border-radius:14px;
      font-weight:850; cursor:pointer;
    }
    .chip.active{
      border-color: rgba(34,225,161,.65);
      background: rgba(34,225,161,.12);
      box-shadow: 0 10px 26px rgba(34,225,161,.12);
    }
    .row{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-top:10px;}
    .status{
      margin-top:10px;padding:12px;border-radius:14px;border:1px solid var(--stroke);
      background: rgba(0,0,0,.14); color: rgba(234,241,255,.75);
      font-weight:700; white-space: pre-line;
    }
    .mealCard,.dayCard{
      background: rgba(0,0,0,.18); border:1px solid rgba(255,255,255,.08);
      border-radius:22px; padding:16px; margin:14px 0;
      box-shadow: 0 18px 48px rgba(0,0,0,.30);
    }
    .mealTop{display:flex;align-items:flex-start;justify-content:space-between;gap:14px;}
    .mealName{color:var(--green);font-weight:1000;letter-spacing:.8px;text-transform:uppercase;font-size:14px;}
    .mealDesc{margin-top:10px;font-size:15px;color:rgba(234,241,255,.86);font-weight:750;line-height:1.25;}
    .kcal{
      background: rgba(0,0,0,.22); border:1px solid rgba(255,255,255,.08);
      border-radius:999px; padding:10px 12px; font-weight:1000;
      color: rgba(34,225,161,.9); min-width:96px; text-align:center;
    }
    .dayTitle{display:flex;align-items:center;justify-content:space-between;font-weight:1000;letter-spacing:.5px;margin-bottom:10px;}
    .exercise{
      display:flex;align-items:center;justify-content:space-between;gap:12px;
      padding:12px;border-radius:18px;border:1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.03); margin:10px 0;
    }
    .exercise small{color: rgba(234,241,255,.66); font-weight:750}
    .ytBtn{
      border:0;border-radius:16px;padding:12px;font-weight:1000;
      background: rgba(34,225,161,.10); color: rgba(34,225,161,.95);
      border:1px solid rgba(34,225,161,.25); cursor:pointer; min-width:130px;
    }
    .nav{
      position:fixed;left:0;right:0;bottom:0;
      padding:10px 10px calc(10px + env(safe-area-inset-bottom));
      background: rgba(7,16,31,.72); backdrop-filter: blur(14px);
      border-top:1px solid rgba(255,255,255,.10);
      display:flex;justify-content:center;z-index:999;
    }
    .navInner{
      width:100%;max-width:520px;display:flex;align-items:center;justify-content:space-between;gap:8px;
      padding:10px;border-radius:22px;background: rgba(0,0,0,.18);
      border:1px solid rgba(255,255,255,.08);
    }
    .navBtn{
      flex:1;border:0;background:transparent;color: rgba(234,241,255,.55);
      font-weight:1000;letter-spacing:.4px;padding:10px 8px;border-radius:16px;
      cursor:pointer;font-size:12px;text-transform:uppercase;
    }
    .navBtn.active{background: rgba(34,225,161,.12);border:1px solid rgba(34,225,161,.25);color: rgba(34,225,161,.95);}
    .shopGrid{display:grid;grid-template-columns:1fr;gap:12px}
    .shopItem{
      border:1px solid rgba(255,255,255,.08); background: rgba(0,0,0,.14);
      border-radius:18px;padding:14px;
    }
    .shopItem h3{margin:0 0 6px;font-weight:1000}
    .shopItem p{margin:0 0 12px;color: rgba(234,241,255,.70);font-weight:650}
    .shopItem button{
      width:100%;border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);color:var(--text);
      border-radius:14px;padding:12px;font-weight:900;cursor:pointer;
    }
  </style>
</head>

<body>
  <div class="app">
    <div class="topbar">
      <div class="brand">
        <div class="logo"><span>E</span></div>
        <div class="titleStack">
          <div class="t1">ELITE TERMINAL</div>
          <div class="t2">Confira o Prato Elite</div>
        </div>
      </div>
      <div class="pill"><span>üîí</span> <span>Modo:</span> <b>PWA</b></div>
    </div>

    <!-- CADASTRO -->
    <section id="viewCadastro" class="screen active">
      <div class="h1">Cadastro</div>

      <div class="card">
        <div class="grid2">
          <div class="field">
            <label>Peso (kg)</label>
            <input id="peso" type="number" inputmode="decimal" placeholder="Ex: 78.5">
          </div>
          <div class="field">
            <label>Altura (cm)</label>
            <input id="altura" type="number" inputmode="numeric" placeholder="Ex: 175">
          </div>
        </div>

        <div class="grid2" style="margin-top:12px;">
          <div class="field">
            <label>Objetivo</label>
            <select id="objetivo">
              <option value="">Selecione</option>
              <option>Emagrecer</option>
              <option>Ganhar massa</option>
              <option>Manter</option>
              <option>Performance</option>
            </select>
          </div>

          <div class="field">
            <label>N√≠vel</label>
            <select id="nivel">
              <option value="">Selecione</option>
              <option>Iniciante</option>
              <option>Intermedi√°rio</option>
              <option>Avan√ßado</option>
            </select>
          </div>
        </div>

        <div class="grid2" style="margin-top:12px;">
          <div class="field">
            <label>Condi√ß√£o</label>
            <select id="condicao">
              <option value="">Selecione</option>
              <option>Sedentarismo</option>
              <option>Ativo</option>
              <option>Muito ativo</option>
            </select>
          </div>
          <div class="field">
            <label>Restri√ß√£o</label>
            <select id="restricao">
              <option value="">Selecione</option>
              <option>Nenhuma</option>
              <option>Sem lactose</option>
              <option>Vegetariano</option>
              <option>Vegano</option>
              <option>Sem gl√∫ten</option>
            </select>
          </div>
        </div>

        <div style="margin-top:14px;">
          <label>Esportes (pode marcar v√°rios)</label>
          <div id="chipsEsportes" class="chips"></div>
        </div>

        <div class="row" style="margin-top:14px;">
          <label style="display:flex; gap:10px; align-items:center; text-transform:none; letter-spacing:0;">
            <input id="termos" type="checkbox" style="width:18px;height:18px;">
            <span style="font-weight:900; color:var(--text)">Aceito o termo</span>
          </label>
        </div>

        <div style="margin-top:12px;">
          <button class="btn" type="button" onclick="salvarCadastro()">SALVAR / ATUALIZAR</button>
          <div style="height:10px"></div>
          <button class="btn secondary" type="button" onclick="limparCadastro()">LIMPAR</button>
        </div>

        <div id="outCadastro" class="status" style="display:none"></div>
      </div>
    </section>

    <!-- PRATO -->
    <section id="viewPrato" class="screen">
      <div class="h1">Prato</div>

      <div class="card">
        <div class="hint">Tire uma foto do prato ou escolha da galeria. (Por enquanto √© mock, depois ligamos IA real.)</div>

        <div style="height:12px"></div>
        <input id="fotoPrato" type="file" accept="image/*" capture="environment" />

        <div id="pratoPreviewWrap" style="display:none; margin-top:12px;">
          <div class="mealCard" style="padding:12px;">
            <div class="mealName">Preview</div>
            <div style="height:10px"></div>
            <img id="pratoPreview" alt="Foto do prato"
              style="width:100%; border-radius:18px; border:1px solid rgba(255,255,255,.10);" />
          </div>

          <button class="btn" type="button" onclick="analisarPrato()">ANALISAR PRATO</button>
          <div style="height:10px"></div>
          <button class="btn secondary" type="button" onclick="limparPrato()">REMOVER FOTO</button>
        </div>

        <div id="pratoStatus" class="status" style="display:none"></div>
      </div>
    </section>

    <!-- DIETA -->
    
<section id="viewDieta" class="screen">
  <div class="h1">Dieta</div>

  <div class="card">
    <div class="hint">
      Dieta gerada com base no seu cadastro (objetivo + restri√ß√£o).<br>
      Se n√£o gostar, toque em <b>Gerar nova dieta</b>.
    </div>

    <div style="height:12px"></div>
    <button class="btn" type="button" onclick="gerarDieta()">GERAR NOVA DIETA</button>
  </div>

  <div id="dietaOut"></div>
</section>

    <!-- TREINO -->
    <section id="viewTreino" class="screen">
      <div class="h1">Treinos</div>

      <div class="card">
        <div class="hint">Clique em <b>Ver t√©cnica</b> para abrir o YouTube com a execu√ß√£o.</div>
      </div>

      <div class="dayCard">
        <div class="dayTitle"><span>DIA A ‚Ä¢ For√ßa</span><span>‚úÖ</span></div>

        <div class="exercise">
          <div>
            <b>Desenvolvimento com halteres</b>
            <small>3 s√©ries x 10 reps</small>
          </div>
          <button class="ytBtn" type="button" onclick="openYT('desenvolvimento com halteres como fazer')">Ver t√©cnica</button>
        </div>

        <div class="exercise">
          <div>
            <b>Agachamento livre</b>
            <small>4 s√©ries x 8‚Äì12 reps</small>
          </div>
          <button class="ytBtn" type="button" onclick="openYT('agachamento livre como fazer')">Ver t√©cnica</button>
        </div>

        <div class="exercise">
          <div>
            <b>Flex√£o de bra√ßos</b>
            <small>3 s√©ries at√© a falha</small>
          </div>
          <button class="ytBtn" type="button" onclick="openYT('flex√£o de bra√ßos como fazer')">Ver t√©cnica</button>
        </div>
      </div>
    </section>

    <!-- LOJA -->
    <section id="viewLoja" class="screen">
      <div class="h1">Loja</div>
      <div class="card"><div class="hint">Depois trocamos pelos seus links de afiliado.</div></div>

      <div class="shopGrid">
        <div class="shopItem">
          <h3>Suplementos</h3><p>Whey, creatina, vitaminas.</p>
          <button type="button" onclick="abrirLink('https://www.mercadolivre.com.br')">Abrir</button>
        </div>
        <div class="shopItem">
          <h3>Roupas fitness</h3><p>T√™nis, camisetas, shorts.</p>
          <button type="button" onclick="abrirLink('https://www.amazon.com.br')">Abrir</button>
        </div>
      </div>
    </section>

    <!-- PARCEIROS -->
    <section id="viewParceiros" class="screen">
      <div class="h1">Parceiros</div>
      <div class="card">
        <div class="hint">Em breve: parceiros perto de voc√™ (com permiss√£o de localiza√ß√£o).</div>
        <div style="height:12px"></div>
        <button class="btn secondary" type="button" onclick="simularParceiros()">Ver parceiros (simula√ß√£o)</button>
        <div id="outParceiros" class="status" style="display:none"></div>
      </div>
    </section>

    <!-- PREMIUM -->
    <section id="viewPremium" class="screen">
      <div class="h1">Premium</div>
      <div class="card">
        <div style="font-weight:1000; letter-spacing:.8px; color:var(--yellow); text-transform:uppercase;">
          Assinatura Elite
        </div>
        <div style="height:10px"></div>
        <div class="hint">R$ 29,90/m√™s. Pagamento via Mercado Pago. N√£o coletamos dados do cart√£o aqui.</div>
        <div style="height:14px"></div>
        <button id="btnPremium" class="btn yellow" type="button" onclick="openCheckout()">CONFIRMAR R$ 29,90/M√äS</button>
      </div>
    </section>

    <!-- CONVITES -->
    <section id="viewConvites" class="screen">
      <div class="h1">Convites</div>
      <div class="card">
        <div class="hint">
          MVP: simula√ß√£o local. Ideia: ganhar R$ 5 por assinatura confirmada. Saque m√≠nimo R$ 50 via Pix (depois).
        </div>

        <div class="dayCard">
          <div class="dayTitle"><span>Seu c√≥digo</span><span id="myCode"></span></div>
          <div class="hint" id="myLink" style="word-break:break-all;"></div>

          <div class="row">
            <button class="btn secondary" type="button" onclick="copyInviteLink()">Copiar link</button>
            <button class="btn" type="button" onclick="shareInvite()">Compartilhar</button>
          </div>
        </div>

        <div class="dayCard">
          <div class="dayTitle"><span>Saldo</span><span id="balTxt"></span></div>
          <div class="hint" id="progressTxt"></div>

          <div class="row" style="margin-top:10px;">
            <button class="btn secondary" type="button" onclick="setBalance(getBalance()+5)">+R$5 (teste)</button>
            <button class="btn secondary" type="button" onclick="setBalance(0)">Zerar</button>
          </div>
        </div>
      </div>
    </section>

  </div>

  <!-- NAV -->
  <div class="nav">
    <div class="navInner">
      <button class="navBtn active" data-view="cadastro" type="button">Cadastro</button>
      <button class="navBtn" data-view="prato" type="button">Prato</button>
      <button class="navBtn" data-view="dieta" type="button">Dieta</button>
      <button class="navBtn" data-view="treino" type="button">Treino</button>
      <button class="navBtn" data-view="loja" type="button">Loja</button>
      <button class="navBtn" data-view="parceiros" type="button">Parceiros</button>
      <button class="navBtn" data-view="premium" type="button">Premium</button>
      <button class="navBtn" data-view="convites" type="button">Convites</button>
    </div>
  </div>

  <script>
    // PWA
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("./service-worker.js").catch(()=>{});
    }

    // Premium
    const PREMIUM_PRICE = 29.90;
    const PREMIUM_CHECKOUT_URL = "https://mpago.la/2BRjpaP";
    function openCheckout(){ window.open(PREMIUM_CHECKOUT_URL, "_blank"); }

    // Helpers
    const $ = (id)=> document.getElementById(id);
    function abrirLink(url){ window.open(url, "_blank"); }
    function openYT(query){
      const q = encodeURIComponent(query);
      window.open(`https://www.youtube.com/results?search_query=${q}`, "_blank");
    }

    // NAV
    function switchView(view){
      document.querySelectorAll(".screen").forEach(s => s.classList.remove("active"));
      document.querySelectorAll(".navBtn").forEach(b => b.classList.remove("active"));

      const map = {
        cadastro: "viewCadastro",
        prato: "viewPrato",
        dieta: "viewDieta",
        treino: "viewTreino",
        loja: "viewLoja",
        parceiros: "viewParceiros",
        premium: "viewPremium",
        convites: "viewConvites",
      };

      const id = map[view];
      if(id && $(id)) $(id).classList.add("active");

      const btn = document.querySelector(`.navBtn[data-view="${view}"]`);
      if(btn) btn.classList.add("active");
    }

    function wireNav(){
      document.querySelectorAll(".navBtn").forEach(btn=>{
        btn.addEventListener("click", ()=> switchView(btn.dataset.view));
      });
    }

    // Esportes
    const ESPORTES = [
      "Muscula√ß√£o","Futebol","Corrida","Crossfit","Ciclismo","Nata√ß√£o",
      "Luta","Basquete","V√¥lei","Yoga","Pilates","Caminhada"
    ];
    let selectedSports = new Set();

    function buildSportsChips(){
      const box = $("chipsEsportes");
      if(!box) return;
      box.innerHTML = "";

      ESPORTES.forEach((name)=>{
        const chip = document.createElement("button");
        chip.type = "button";
        chip.className = "chip";
        chip.textContent = name;

        chip.addEventListener("click", ()=>{
          if(selectedSports.has(name)) selectedSports.delete(name);
          else selectedSports.add(name);
          chip.classList.toggle("active", selectedSports.has(name));
        });

        box.appendChild(chip);
      });
    }

    // Cadastro
    const KEY_PROFILE = "checkprato_profile_v1";

    function showCadastroMsg(text){
      const out = $("outCadastro");
      out.style.display = "block";
      out.textContent = text;
    }

    function salvarCadastro(){
      if(!$("termos").checked){
        showCadastroMsg("‚ö†Ô∏è Voc√™ precisa aceitar o termo para salvar.");
        return;
      }
      const profile = {
        peso: $("peso").value || "",
        altura: $("altura").value || "",
        objetivo: $("objetivo").value || "",
        nivel: $("nivel").value || "",
        condicao: $("condicao").value || "",
        restricao: $("restricao").value || "",
        esportes: Array.from(selectedSports),
        updatedAt: Date.now(),
      };
      localStorage.setItem(KEY_PROFILE, JSON.stringify(profile));
      showCadastroMsg("‚úÖ Cadastro salvo com sucesso!");
    }

    function limparCadastro(){
      localStorage.removeItem(KEY_PROFILE);
      $("peso").value = "";
      $("altura").value = "";
      $("objetivo").value = "";
      $("nivel").value = "";
      $("condicao").value = "";
      $("restricao").value = "";
      $("termos").checked = false;
      selectedSports = new Set();
      buildSportsChips();
      showCadastroMsg("üßπ Cadastro limpo.");
    }

    function carregarCadastro(){
      const raw = localStorage.getItem(KEY_PROFILE);
      if(!raw) return;
      try{
        const p = JSON.parse(raw);
        $("peso").value = p.peso || "";
        $("altura").value = p.altura || "";
        $("objetivo").value = p.objetivo || "";
        $("nivel").value = p.nivel || "";
        $("condicao").value = p.condicao || "";
        $("restricao").value = p.restricao || "";
        $("termos").checked = true;

        selectedSports = new Set(Array.isArray(p.esportes) ? p.esportes : []);
        buildSportsChips();
        document.querySelectorAll("#chipsEsportes .chip").forEach(ch=>{
          if(selectedSports.has(ch.textContent)) ch.classList.add("active");
        });

        showCadastroMsg("‚úÖ Cadastro carregado do aparelho.");
      } catch {}
    }

    // Parceiros (simula√ß√£o)
    function simularParceiros(){
      const out = $("outParceiros");
      out.style.display = "block";
      out.textContent =
        "üìç Exemplo (simula√ß√£o):\n" +
        "‚Ä¢ Academia Elite Center (2,1 km)\n" +
        "‚Ä¢ Loja Fit Suplementos (3,4 km)\n" +
        "‚Ä¢ Box Cross Training (4,0 km)";
    }

    // Convites
    const KEY_MY_CODE = "checkprato_my_invite_code";
    const KEY_BAL = "checkprato_invite_balance";

    function getOrCreateInviteCode(){
      let code = localStorage.getItem(KEY_MY_CODE);
      if(!code){
        code = Math.random().toString(36).slice(2,8).toUpperCase();
        localStorage.setItem(KEY_MY_CODE, code);
      }
      return code;
    }
    function getMyInviteLink(){
      const code = getOrCreateInviteCode();
      const base = window.location.origin + window.location.pathname;
      return `${base}?ref=${encodeURIComponent(code)}`;
    }
    async function copyInviteLink(){
      const link = getMyInviteLink();
      try{ await navigator.clipboard.writeText(link); alert("‚úÖ Link copiado!"); }
      catch { prompt("Copie o link:", link); }
    }
    function shareInvite(){
      const link = getMyInviteLink();
      const text = `Baixa o Confira o Prato Elite e usa meu link: ${link}`;
      if(navigator.share){ navigator.share({title:"Confira o Prato Elite", text, url: link}).catch(()=>{}); }
      else copyInviteLink();
    }
    function getBalance(){ return Number(localStorage.getItem(KEY_BAL) || "0"); }
    function setBalance(v){ localStorage.setItem(KEY_BAL, String(v)); renderInviteUI(); }

    function renderInviteUI(){
      const code = getOrCreateInviteCode();
      const link = getMyInviteLink();
      const bal = getBalance();
      const falta = Math.max(0, 50 - bal);

      $("myCode").textContent = code;
      $("myLink").textContent = link;
      $("balTxt").textContent = new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(bal);
      $("progressTxt").textContent = bal >= 50
        ? "‚úÖ Voc√™ atingiu R$ 50. (Saque via Pix ser√° liberado quando ligarmos o sistema.)"
        : `Faltam ${new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(falta)} para atingir R$ 50.`;
    }

    // PRATO (foto + mock)
    const KEY_LAST_PLATE = "checkprato_last_plate_v1";
    let pratoImgDataUrl = "";

    function setPratoStatus(msg){
      const el = $("pratoStatus");
      if(!el) return;
      el.style.display = "block";
      el.textContent = msg;
    }

    function renderPlateResult(result){
      setPratoStatus(
        `‚úÖ Resultado estimado (mock)\n` +
        `Calorias: ${result.kcal} kcal\n` +
        `Prote√≠na: ${result.prot} g\n` +
        `Carboidratos: ${result.carb} g\n` +
        `Gorduras: ${result.fat} g\n\n` +
        `Obs: estimativa ilustrativa. Depois ligamos IA real.`
      );
    }

    function calcMockFromProfile(){
      let peso = Number($("peso")?.value || 0);
      let objetivo = $("objetivo")?.value || "";
      let nivel = $("nivel")?.value || "";

      let kcal = 650;
      if(peso > 0) kcal += Math.round((peso - 70) * 3);
      if(objetivo === "Emagrecer") kcal -= 120;
      if(objetivo === "Ganhar massa") kcal += 180;
      if(objetivo === "Performance") kcal += 140;
      if(nivel === "Iniciante") kcal -= 40;
      if(nivel === "Avan√ßado") kcal += 70;

      kcal += Math.floor(Math.random()*120) - 60;
      kcal = Math.max(250, Math.min(1200, kcal));

      const prot = Math.max(15, Math.round(kcal * 0.20 / 4));
      const carb = Math.max(20, Math.round(kcal * 0.50 / 4));
      const fat  = Math.max(10, Math.round(kcal * 0.30 / 9));
      return { kcal, prot, carb, fat };
    }

    async function analisarPrato(){
      if(!pratoImgDataUrl){
        setPratoStatus("‚ö†Ô∏è Primeiro selecione uma foto do prato.");
        return;
      }
      setPratoStatus("üîé Analisando... (mock)\nAguarde 2 segundos.");
      await new Promise(r => setTimeout(r, 2000));

      const result = calcMockFromProfile();
      renderPlateResult(result);

      localStorage.setItem(KEY_LAST_PLATE, JSON.stringify({
        img: pratoImgDataUrl, result, updatedAt: Date.now()
      }));
    }

    function limparPrato(){
      pratoImgDataUrl = "";
      $("fotoPrato").value = "";
      $("pratoPreviewWrap").style.display = "none";
      $("pratoStatus").style.display = "none";
      localStorage.removeItem(KEY_LAST_PLATE);
    }

    function wirePlateInput(){
      const input = $("fotoPrato");
      if(!input) return;
      input.addEventListener("change", ()=>{
        const file = input.files && input.files[0];
        if(!file) return;
        const reader = new FileReader();
        reader.onload = ()=>{
          pratoImgDataUrl = String(reader.result || "");
          $("pratoPreview").src = pratoImgDataUrl;
          $("pratoPreviewWrap").style.display = "block";
          setPratoStatus("‚úÖ Foto carregada. Clique em ANALISAR PRATO.");
        };
        reader.readAsDataURL(file);
      });
    }

    function loadLastPlate(){
      try{
        const raw = localStorage.getItem(KEY_LAST_PLATE);
        if(!raw) return;
        const data = JSON.parse(raw);
        if(data?.img){
          pratoImgDataUrl = data.img;
          $("pratoPreview").src = pratoImgDataUrl;
          $("pratoPreviewWrap").style.display = "block";
        }
        if(data?.result) renderPlateResult(data.result);
      } catch {}
    }

    // INIT
    function init(){
      wireNav();
      buildSportsChips();
      carregarCadastro();
      wirePlateInput();
      loadLastPlate();
      renderInviteUI();

      const d = carregarDieta();
      renderDieta(d);
      
      const btnPremium = $("btnPremium");
      if(btnPremium){
        btnPremium.textContent = `CONFIRMAR R$ ${PREMIUM_PRICE.toFixed(2).replace(".", ",")}/M√äS`;
      }
    }
    document.addEventListener("DOMContentLoaded", init);
 
  </script>
  // ===== DIETA (baseada no cadastro) =====
const KEY_DIETA = "checkprato_dieta_v1";

function pick(arr){
  return arr[Math.floor(Math.random() * arr.length)];
}

function formatMeal(title, desc, kcal){
  return `
    <div class="mealCard">
      <div class="mealTop">
        <div>
          <div class="mealName">${title}</div>
          <div class="mealDesc">${desc}</div>
        </div>
        <div class="kcal">${kcal} kcal</div>
      </div>
    </div>
  `;
}

function getProfileSafe(){
  try{
    const raw = localStorage.getItem(KEY_PROFILE);
    if(!raw) return null;
    return JSON.parse(raw);
  } catch { return null; }
}

function dietaBase(profile){
  const objetivo = profile?.objetivo || "";
  const restricao = profile?.restricao || "Nenhuma";

  // Faixas simples por objetivo
  let baseKcal = 1800;
  if(objetivo === "Emagrecer") baseKcal = 1600;
  if(objetivo === "Ganhar massa") baseKcal = 2300;
  if(objetivo === "Performance") baseKcal = 2100;
  if(objetivo === "Manter") baseKcal = 1900;

  // Ajuste leve por peso
  const peso = Number(profile?.peso || 0);
  if(peso > 0) baseKcal += Math.round((peso - 70) * 6);

  // Regras de restri√ß√£o (trocas)
  const noLactose = restricao === "Sem lactose";
  const vegetariano = restricao === "Vegetariano";
  const vegano = restricao === "Vegano";

</body>
</html>
