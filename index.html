<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>Confira o Prato Elite</title>

  <!-- PWA -->
  <meta name="theme-color" content="#0a1320"/>
  <link rel="manifest" href="./manifest.json">
  <link rel="icon" sizes="192x192" href="./icon-192.png">
  <link rel="apple-touch-icon" href="./icon-192.png">

  <style>
    :root{
      --bg:#07121f;
      --bg2:#0b2033;
      --card:rgba(255,255,255,.04);
      --card2:rgba(255,255,255,.06);
      --stroke:rgba(255,255,255,.08);
      --txt:#eaf2ff;
      --muted:rgba(234,242,255,.72);
      --green:#21e6b6;
      --green2:#17caa0;
      --orange:#f6b23a;
      --shadow:0 20px 60px rgba(0,0,0,.45);
      --r:22px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--txt);
      background: radial-gradient(1200px 600px at 30% 0%, #10324d 0%, var(--bg) 55%, #050a12 100%);
      padding-bottom: 88px;
    }

    .app{
      max-width: 540px;
      margin: 0 auto;
      padding: 16px 14px 24px;
    }

    .topbar{
      display:flex;
      align-items:center;
      gap:12px;
      margin-top:6px;
      margin-bottom: 14px;
    }
    .logo{
      width:44px;height:44px;border-radius:14px;
      background: linear-gradient(135deg, rgba(33,230,182,.35), rgba(33,230,182,.05));
      border:1px solid rgba(33,230,182,.35);
      display:flex;align-items:center;justify-content:center;
      font-weight:900;
      color:var(--green);
      box-shadow: var(--shadow);
      flex:0 0 auto;
    }
    .brand{
      display:flex;flex-direction:column;gap:2px;
      min-width: 0;
      flex: 1 1 auto;
    }
    .brand small{color:var(--muted); letter-spacing:.08em; font-weight:800}
    .brand b{font-size:18px}
    .pill{
      display:flex;align-items:center;gap:8px;
      padding:10px 12px;border-radius:999px;
      background: rgba(255,255,255,.04);
      border:1px solid var(--stroke);
      color:var(--muted);
      font-weight:700;
      flex:0 0 auto;
    }
    .pill .dot{
      width:10px;height:10px;border-radius:99px;background:var(--green);
      box-shadow: 0 0 0 6px rgba(33,230,182,.12);
    }

    .h1{
      font-size:40px;
      margin:12px 2px 14px;
      letter-spacing:.02em;
      color:var(--green);
      font-weight: 900;
    }
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.03));
      border: 1px solid var(--stroke);
      border-radius: var(--r);
      padding: 16px;
      box-shadow: var(--shadow);
    }
    .hint{
      color: var(--muted);
      font-weight: 600;
      line-height: 1.35;
    }

    .row{display:flex; gap:12px; flex-wrap:wrap}
    .col{flex:1 1 140px; min-width: 140px}

    .label{
      margin: 12px 2px 6px;
      color: rgba(234,242,255,.65);
      font-weight: 900;
      letter-spacing:.12em;
      text-transform: uppercase;
      font-size: 12px;
    }

    input, select{
      width:100%;
      padding:14px 14px;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
      color: var(--txt);
      outline: none;
      font-size: 15px;
    }
    input::placeholder{color: rgba(234,242,255,.35)}
    select{appearance:none}

    .btn{
      width:100%;
      padding: 16px 16px;
      border-radius: 18px;
      border: 0;
      cursor: pointer;
      font-weight: 900;
      font-size: 16px;
      letter-spacing: .02em;
      background: linear-gradient(135deg, var(--green), var(--green2));
      color:#042019;
      box-shadow: 0 18px 45px rgba(33,230,182,.18);
      margin-top: 14px;
    }
    .btnSecondary{
      width:100%;
      padding: 14px 16px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.10);
      cursor: pointer;
      font-weight: 900;
      font-size: 15px;
      background: rgba(255,255,255,.05);
      color: var(--txt);
      margin-top: 10px;
    }
    .btnOrange{
      width:100%;
      padding: 16px 16px;
      border-radius: 18px;
      border: 0;
      cursor: pointer;
      font-weight: 900;
      font-size: 16px;
      background: linear-gradient(135deg, #ffcc5a, #f6b23a);
      color:#201400;
      margin-top: 12px;
      box-shadow: 0 18px 45px rgba(246,178,58,.18);
    }
    .status{
      margin-top: 10px;
      font-weight: 800;
      color: rgba(234,242,255,.78);
    }

    .chips{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      margin-top: 10px;
    }
    .chip{
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      color: var(--muted);
      font-weight: 900;
      cursor: pointer;
      user-select: none;
    }
    .chip.on{
      border-color: rgba(33,230,182,.45);
      background: rgba(33,230,182,.12);
      color: var(--txt);
      box-shadow: 0 0 0 6px rgba(33,230,182,.08);
    }

    .screen{
  display:none;
  margin-top: 8px;
  max-width: 540px;
  margin-left: auto;
  margin-right: auto;
  padding: 0 16px 120px;
  }

.screen.active{
  display:block;
}
   
    /* NAV */
    .nav{
      position: fixed;
      left:0; right:0; bottom:0;
      padding: 10px 10px calc(10px + env(safe-area-inset-bottom));
      background: linear-gradient(180deg, rgba(7,18,31,.1), rgba(7,18,31,.85) 35%, rgba(7,18,31,.98));
      border-top: 1px solid rgba(255,255,255,.08);
      backdrop-filter: blur(10px);
      z-index: 999;
    }
    .navInner{
      max-width: 540px;
      margin: 0 auto;
      display:flex;
      gap:10px;
      overflow-x: auto;
      padding: 6px 6px;
      scrollbar-width: none;
    }
    .navInner::-webkit-scrollbar{display:none}
    .navBtn{
      flex:0 0 auto;
      border:1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.03);
      color: rgba(234,242,255,.6);
      font-weight: 900;
      padding: 12px 14px;
      border-radius: 999px;
      cursor:pointer;
      letter-spacing:.05em;
    }
    .navBtn.active{
      background: rgba(33,230,182,.12);
      border-color: rgba(33,230,182,.35);
      color: var(--green);
      box-shadow: 0 0 0 6px rgba(33,230,182,.08);
    }

    /* Diet cards */
    .meal{
      display:flex;
      justify-content:space-between;
      gap:12px;
      padding: 16px;
      border-radius: 22px;
      border: 1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.03);
      margin-top: 12px;
    }
    .meal .title{
      font-weight: 900;
      color: var(--green);
      letter-spacing:.08em;
      text-transform: uppercase;
      font-size: 12px;
      margin-bottom: 6px;
    }
    .meal p{margin:0; color: rgba(234,242,255,.85); font-weight:700; line-height:1.35}
    .kcal{
      display:flex; align-items:center; justify-content:center;
      min-width: 88px;
      border-radius: 999px;
      border:1px solid rgba(33,230,182,.25);
      background: rgba(33,230,182,.08);
      color: var(--green);
      font-weight: 1000;
      padding: 10px 12px;
      text-align:center;
    }

    /* Treino */
    .dayCard{
      margin-top: 12px;
      padding: 14px;
      border-radius: 22px;
      border: 1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.03);
    }
    .dayTitle{
      display:flex; align-items:center; justify-content:space-between;
      font-weight: 1000;
      color: rgba(234,242,255,.92);
      margin-bottom: 10px;
      letter-spacing:.03em;
    }
    .exercise{
      display:flex; align-items:center; justify-content:space-between;
      gap:12px;
      padding: 12px 12px;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.16);
      margin-top: 10px;
    }
    .ytBtn{
      border:0;
      border-radius: 999px;
      padding: 10px 12px;
      background: rgba(33,230,182,.10);
      border: 1px solid rgba(33,230,182,.25);
      color: var(--green);
      font-weight: 1000;
      cursor: pointer;
      min-width: 110px;
    }n

    /* Loja & Parceiros */
    .shopGrid{display:flex; flex-direction:column; gap:12px; margin-top: 12px}
    .shopItem{
      padding: 16px;
      border-radius: 22px;
      border: 1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.03);
    }
    .shopItem h3{margin:0 0 6px; font-weight: 1000}
    .muted{opacity:.82}

    .partnerList{display:flex; flex-direction:column; gap:12px; margin-top:12px}
    .partnerRow{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      padding:14px;
      border-radius:18px;
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(255,255,255,0.06);
    }
    .partnerName{display:flex; flex-direction:column; gap:4px}
    .partnerName b{font-weight: 1000}

    /* Premium */
    .payBox{
      padding: 14px;
      border-radius: 22px;
      border: 1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.03);
      margin-top: 12px;
    }
    .payTitle{
      font-size: 28px;
      font-weight: 1000;
      color: var(--orange);
      margin: 0 0 6px;
      letter-spacing:.02em;
    }

    /* Plate (foto prato) */
    .plateBox{margin-top: 12px}
    .platePreview{
      width: 100%;
      border-radius: 22px;
      border: 1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.14);
      overflow:hidden;
    }
    .platePreview img{width:100%; display:block}
    .miniRow{display:flex; gap:10px; flex-wrap:wrap}
    .miniBtn{
      flex: 1 1 160px;
      padding: 14px 14px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
      color: var(--txt);
      font-weight: 900;
      cursor: pointer;
    }
  </style>
</head>

<body>
  <div class="app">
    <div class="topbar">
      <div class="logo">E</div>
      <div class="brand">
        <small>ELITE TERMINAL</small>
        <b>Confira o Prato Elite</b>
      </div>
      <div class="pill"><span class="dot"></span>Modo: PWA</div>
    </div>

    <!-- CADASTRO -->
    <section id="viewCadastro" class="screen active">
      <div class="h1">CADASTRO</div>

      <div class="card">
        <div class="row">
          <div class="col">
            <div class="label">Peso (kg)</div>
            <input id="peso" inputmode="decimal" placeholder="Ex: 78.5" />
          </div>
          <div class="col">
            <div class="label">Altura (cm)</div>
            <input id="altura" inputmode="numeric" placeholder="Ex: 175" />
          </div>
        </div>

        <div class="row">
          <div class="col">
            <div class="label">Objetivo</div>
            <select id="objetivo">
              <option value="">Selecione</option>
              <option>Emagrecer</option>
              <option>Ganhar massa</option>
              <option>Manter</option>
              <option>Performance</option>
            </select>
          </div>
          <div class="col">
            <div class="label">N√≠vel</div>
            <select id="nivel">
              <option value="">Selecione</option>
              <option>Iniciante</option>
              <option>Intermedi√°rio</option>
              <option>Avan√ßado</option>
            </select>
          </div>
        </div>

        <div class="row">
          <div class="col">
            <div class="label">Condi√ß√£o</div>
            <select id="condicao">
              <option value="">Selecione</option>
              <option>Saud√°vel</option>
              <option>Hipertens√£o</option>
              <option>Diabetes</option>
              <option>Les√£o / Dor</option>
            </select>
          </div>
          <div class="col">
            <div class="label">Restri√ß√£o</div>
            <select id="restricao">
              <option value="">Selecione</option>
              <option>Nenhuma</option>
              <option>Lactose</option>
              <option>Gl√∫ten</option>
              <option>Vegetariano</option>
              <option>Vegano</option>
            </select>
          </div>
        </div>

        <div class="label">Esportes (pode marcar v√°rios)</div>
        <div id="chipsEsportes" class="chips"></div>

        <div style="margin-top:10px">
          <label style="display:flex; gap:10px; align-items:center; font-weight:900; color:rgba(234,242,255,.9)">
            <input id="termo" type="checkbox" style="width:22px; height:22px"/>
            Aceito o termo
          </label>
          <div class="hint" style="margin-top:6px">As sugest√µes s√£o informativas.</div>
        </div>

        <button class="btn" type="button" onclick="salvarCadastro()">SALVAR / ATUALIZAR</button>
        <button class="btnSecondary" type="button" onclick="limparCadastro()">LIMPAR</button>

        <div id="outCadastro" class="status" style="display:none"></div>
      </div>

      <div class="card plateBox" style="margin-top:14px">
        <div class="label">Foto do prato (demo)</div>
        <div class="hint">Por enquanto √© uma simula√ß√£o (sem IA real). Depois ligamos no Firebase + IA.</div>

        <div class="miniRow" style="margin-top:12px">
          <button class="miniBtn" type="button" id="btnCamera">Tirar foto</button>
          <button class="miniBtn" type="button" id="btnGaleria">Escolher da galeria</button>
        </div>

        <input id="fileCamera" type="file" accept="image/*" capture="environment" style="display:none">
        <input id="fileGaleria" type="file" accept="image/*" style="display:none">

        <div class="platePreview" id="platePreview" style="margin-top:12px; display:none">
          <img id="plateImg" alt="Prato"/>
        </div>

        <button class="btnSecondary" type="button" onclick="analisarPratoDemo()">Analisar (demo)</button>
        <div id="plateResult" class="status" style="display:none"></div>
      </div>
    </section>

    <!-- DIETA -->
    <section id="viewDieta" class="screen">
      <div class="h1">DIETA</div>

      <div class="card">
        <div class="hint">Sugest√µes simples e f√°ceis. Voc√™ pode gerar outra dieta se n√£o gostar.</div>
        <button class="btn" type="button" onclick="gerarDieta()">GERAR NOVA DIETA</button>
        <div id="dietaBox"></div>
      </div>
    </section>

    <!-- TREINO -->
    <section id="viewTreino" class="screen">
      <div class="h1">TREINO</div>

      <div class="card">
        <div class="hint">Treino semanal baseado no seu cadastro. Cada exerc√≠cio tem bot√£o ‚ÄúYouTube‚Äù.</div>

        <div class="row" style="margin-top:10px">
          <div class="col">
            <div class="label">Tema</div>
            <select id="temaTreino">
              <option>Academia</option>
              <option>Corrida</option>
              <option>Muay Thai</option>
              <option>Futebol</option>
              <option>Basquete</option>
            </select>
          </div>
          <div class="col">
            <div class="label">Intensidade</div>
            <select id="intTreino">
              <option>Leve</option>
              <option>Moderado</option>
              <option>Pesado</option>
            </select>
          </div>
        </div>

        <button class="btn" type="button" onclick="gerarTreino()">GERAR TREINO DA SEMANA</button>
        <button class="btnSecondary" type="button" onclick="limparTreino()">LIMPAR TREINO</button>

        <div id="outTreino" class="status" style="display:none"></div>
        <div id="treinoSemana"></div>
      </div>
    </section>

    <!-- LOJA -->
    <section id="viewLoja" class="screen">
      <div class="h1">LOJA</div>

      <div class="card">
        <div class="hint">Depois trocamos por seus links de afiliado/parcerias.</div>

        <div class="shopGrid">
          <div class="shopItem">
            <h3>Suplementos</h3>
            <p class="muted">Whey, creatina, vitaminas e pr√©-treinos para performance e recupera√ß√£o.</p>
            <button class="btnSecondary" type="button" onclick="switchView('parceiros')">Ver parceiros</button>
          </div>

          <div class="shopItem">
            <h3>Roupas fitness</h3>
            <p class="muted">T√™nis, camisetas, shorts e roupas para treino/corrida com conforto e durabilidade.</p>
            <button class="btnSecondary" type="button" onclick="switchView('parceiros')">Ver parceiros</button>
          </div>

          <div class="shopItem">
            <h3>Equipamentos</h3>
            <p class="muted">Acess√≥rios para treino em casa: el√°sticos, corda, luvas, garrafas, etc.</p>
            <button class="btnSecondary" type="button" onclick="switchView('parceiros')">Ver parceiros</button>
          </div>
        </div>
      </div>
    </section>

    <!-- PARCEIROS -->
    <section id="viewParceiros" class="screen">
      <div class="h1">PARCEIROS</div>

      <div class="card">
        <div class="hint">Sites oficiais. Depois trocamos por links de afiliado quando voc√™ tiver.</div>

        <div class="partnerList">
          <div class="partnerRow">
            <div class="partnerName">
              <b>Growth Supplements</b>
              <div class="muted">Whey, creatina e suplementos</div>
            </div>
            <button class="btnSecondary" type="button" onclick="abrirLink('https://www.gsuplementos.com.br')">Abrir</button>
          </div>

          <div class="partnerRow">
            <div class="partnerName">
              <b>Max Titanium</b>
              <div class="muted">Nutri√ß√£o esportiva</div>
            </div>
            <button class="btnSecondary" type="button" onclick="abrirLink('https://www.maxtitanium.com.br')">Abrir</button>
          </div>

          <div class="partnerRow">
            <div class="partnerName">
              <b>Nike</b>
              <div class="muted">T√™nis e roupas</div>
            </div>
            <button class="btnSecondary" type="button" onclick="abrirLink('https://www.nike.com.br')">Abrir</button>
          </div>

          <div class="partnerRow">
            <div class="partnerName">
              <b>Adidas</b>
              <div class="muted">Performance e lifestyle</div>
            </div>
            <button class="btnSecondary" type="button" onclick="abrirLink('https://www.adidas.com.br')">Abrir</button>
          </div>

          <div class="partnerRow">
            <div class="partnerName">
              <b>Mercado Livre</b>
              <div class="muted">Acess√≥rios, equipamentos e suplementos</div>
            </div>
            <button class="btnSecondary" type="button" onclick="abrirLink('https://www.mercadolivre.com.br')">Abrir</button>
          </div>

          <div class="partnerRow">
            <div class="partnerName">
              <b>Shopee</b>
              <div class="muted">Produtos fitness com pre√ßo acess√≠vel</div>
            </div>
            <button class="btnSecondary" type="button" onclick="abrirLink('https://shopee.com.br')">Abrir</button>
          </div>
        </div>
      </div>
    </section>

    <!-- PREMIUM -->
    <section id="viewPremium" class="screen">
      <div class="h1">PREMIUM</div>

      <div class="card">
        <div class="payTitle">ASSINATURA ELITE</div>
        <div class="hint">Pre√ßo mensal. O pagamento abre no Mercado Pago.</div>

        <div class="payBox">
          <div class="label">Plano</div>
          <div style="font-weight:1000; font-size:18px">Elite Premium ‚Äî R$ 29,90/m√™s</div>
          <div class="muted" style="margin-top:8px">Benef√≠cios: dietas ilimitadas, treinos completos, convites com recompensa, parceiros e novidades.</div>
        </div>

        <button id="btnPremium" class="btnOrange" type="button" onclick="openCheckout()">CONFIRMAR R$ 29,90/M√äS</button>
        <div class="hint" style="margin-top:10px">Ambiente seguro ‚Ä¢ SSL</div>
      </div>
    </section>

    <!-- CONVITES -->

        <section id="viewConvites" class="screen">
      <div class="h1">CONVITES</div>

      <div class="card">
        <div class="hint">
          Convide amigos e ganhe: <b>R$ 5</b> por cada pessoa que assinar usando seu link.
          Ao atingir <b>R$ 50</b>, voc√™ pode solicitar saque (futuro) e ainda ganha <b>1 m√™s gr√°tis</b>.
        </div>

        <div style="margin-top:12px" class="payBox">
          <div class="label">Seu c√≥digo</div>
          <div id="myCode" style="font-weight:1000; font-size:18px">‚Äî</div>

          <div class="label" style="margin-top:12px">Seu link</div>
          <div id="myLink" class="muted" style="word-break:break-all">‚Äî</div>

          <div class="label" style="margin-top:12px">Saldo (demo)</div>
          <div id="balTxt" style="font-weight:1000; font-size:18px">R$ 0,00</div>
          <div id="progressTxt" class="muted" style="margin-top:6px"></div>

          <div class="miniRow" style="margin-top:12px">
            <button class="miniBtn" type="button" onclick="copyInviteLink()">Copiar link</button>
            <button class="miniBtn" type="button" onclick="shareInvite()">Compartilhar</button>
          </div>

          <!-- bot√µes de teste (pode remover depois) -->
          <div class="miniRow" style="margin-top:10px">
            <button class="miniBtn" type="button" onclick="setBalance(getBalance()+5)">+R$5 (teste)</button>
            <button class="miniBtn" type="button" onclick="setBalance(0)">Zerar (teste)</button>
          </div>
        </div>
      </div>
    </section>
<!-- SA√öDE / DICAS -->
<section id="viewSaude" class="screen">
  <div class="h1">SA√öDE</div>

  <div class="card">
    <div class="hint">
      Conte√∫do educativo. N√£o substitui m√©dico. Em caso de sintomas ou d√∫vidas, procure um profissional.
    </div>

    <div class="meal" style="margin-top:14px">
      <div>
        <div class="title">Riscos gerais</div>
        <p>Uso de anabolizantes pode causar efeitos no cora√ß√£o, press√£o, colesterol, f√≠gado, humor e horm√¥nios.</p>
      </div>
    </div>

    <div class="meal">
      <div>
        <div class="title">Sinais de alerta</div>
        <p>Dor no peito, falta de ar, palpita√ß√£o, desmaio, incha√ßo, pele/olhos amarelados, urina escura: pare e procure atendimento.</p>
      </div>
    </div>

    <div class="meal">
      <div>
        <div class="title">Exames</div>
        <p>Antes e durante: press√£o, hemograma, lipidograma, glicemia, TGO/TGP, creatinina, testosterona, estradiol. Com m√©dico.</p>
      </div>
    </div>

    <div class="meal">
      <div>
        <div class="title">H√°bitos que ajudam</div>
        <p>Sono 7‚Äì9h, hidrata√ß√£o, dieta com fibras, controle de √°lcool, treino com progress√£o e descanso.</p>
      </div>
    </div>

    <button class="btnSecondary" type="button" onclick="abrirLink('https://bvsms.saude.gov.br/')">
      Ler mais (fontes de sa√∫de)
    </button>
  </div>
</section>
    
  </div>

  <!-- NAV -->
  <div class="nav">
    <div class="navInner">
      <button class="navBtn active" data-view="cadastro" type="button">CADASTRO</button>
      <button class="navBtn" data-view="dieta" type="button">DIETA</button>
      <button class="navBtn" data-view="treino" type="button">TREINO</button>
      <button class="navBtn" data-view="loja" type="button">LOJA</button>
      <button class="navBtn" data-view="parceiros" type="button">PARCEIROS</button>
      <button class="navBtn" data-view="premium" type="button">PREMIUM</button>
      <button class="navBtn" data-view="saude" type="button">SA√öDE</button>
      <button class="navBtn" data-view="convites" type="button">CONVITES</button>
    </div>
  </div>

  <script>
    // PWA
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("./service-worker.js").catch(()=>{});
    }

    // Premium / pagamento
    const PREMIUM_PRICE = 29.90;
    const PREMIUM_CHECKOUT_URL = "https://mpago.la/2BRjpaP";
    function openCheckout(){ window.open(PREMIUM_CHECKOUT_URL, "_blank"); }
    window.openCheckout = openCheckout;

    // Helpers
    const $ = (id)=> document.getElementById(id);
    function abrirLink(url){ window.open(url, "_blank"); }
    window.abrirLink = abrirLink;

    function openYT(query){
      const q = encodeURIComponent(query);
      window.open(`https://www.youtube.com/results?search_query=${q}`, "_blank");
    }

    // Storage keys
    const KEY_PROFILE = "checkprato_profile_v1";
    const KEY_PLATE = "checkprato_plate_v1";
    const KEY_DIETA = "checkprato_dieta_v1";
    const KEY_TREINO = "checkprato_treino_v1";
    const KEY_INV_CODE = "checkprato_inv_code_v1";
    const KEY_BAL = "checkprato_inv_balance_v1";

    // Esportes
    const ESPORTES = [
      "Muscula√ß√£o","Futebol","Corrida","Crossfit","Ciclismo","Nata√ß√£o",
      "Luta","Basquete","V√¥lei","Yoga","Pilates","Caminhada"
    ];
    let selectedSports = new Set();

    function buildSportsChips(){
      const box = $("chipsEsportes");
      if(!box) return;
      box.innerHTML = "";
      ESPORTES.forEach(name=>{
        const div = document.createElement("div");
        div.className = "chip";
        div.textContent = name;
        div.addEventListener("click", ()=>{
          if(selectedSports.has(name)) selectedSports.delete(name);
          else selectedSports.add(name);
          div.classList.toggle("on");
        });
        box.appendChild(div);
      });

      // se tiver perfil salvo, marca
      const p = carregarCadastro();
      if(p && Array.isArray(p.esportes)){
        selectedSports = new Set(p.esportes);
        [...box.querySelectorAll(".chip")].forEach(ch=>{
          if(selectedSports.has(ch.textContent)) ch.classList.add("on");
        });
      }
    }

    // NAV
    function switchView(view){
      document.querySelectorAll(".screen").forEach(s => s.classList.remove("active"));
      document.querySelectorAll(".navBtn").forEach(b => b.classList.remove("active"));

      const map = {
        cadastro:"viewCadastro",
        dieta:"viewDieta",
        treino:"viewTreino",
        loja:"viewLoja",
        parceiros:"viewParceiros",
        premium:"viewPremium",
        convites:"viewConvites",
        saude:"viewSaude",
      };
      const id = map[view];
      if(id){
        const el = document.getElementById(id);
        if(el) el.classList.add("active");
      }
      const btn = document.querySelector(`.navBtn[data-view="${view}"]`);
      if(btn) btn.classList.add("active");
    }
    window.switchView = switchView;

    function wireNav(){
      document.querySelectorAll(".navBtn").forEach(btn=>{
        btn.addEventListener("click", ()=> switchView(btn.dataset.view));
      });
    }

    // Cadastro
    function carregarCadastro(){
      try{ return JSON.parse(localStorage.getItem(KEY_PROFILE) || "null"); }catch{ return null; }
    }

    function salvarCadastro(){
      const termo = $("termo")?.checked;
      if(!termo){
        alert("Marque 'Aceito o termo' para salvar.");
        return;
      }

      const perfil = {
        peso: ($("peso")?.value || "").trim(),
        altura: ($("altura")?.value || "").trim(),
        objetivo: $("objetivo")?.value || "",
        nivel: $("nivel")?.value || "",
        condicao: $("condicao")?.value || "",
        restricao: $("restricao")?.value || "",
        esportes: Array.from(selectedSports),
        updatedAt: Date.now()
      };

      localStorage.setItem(KEY_PROFILE, JSON.stringify(perfil));
      const out = $("outCadastro");
      if(out){
        out.style.display = "block";
        out.textContent = "‚úÖ Cadastro salvo.";
      }
    }
    window.salvarCadastro = salvarCadastro;

    function limparCadastro(){
      localStorage.removeItem(KEY_PROFILE);
      ["peso","altura"].forEach(id=>{ if($(id)) $(id).value=""; });
      ["objetivo","nivel","condicao","restricao"].forEach(id=>{ if($(id)) $(id).value=""; });
      if($("termo")) $("termo").checked = false;
      selectedSports = new Set();
      buildSportsChips();
      const out = $("outCadastro");
      if(out){ out.style.display="block"; out.textContent="üßπ Cadastro limpo."; }
    }
    window.limparCadastro = limparCadastro;

    function aplicarCadastroNaTela(){
      const p = carregarCadastro();
      if(!p) return;
      if($("peso")) $("peso").value = p.peso || "";
      if($("altura")) $("altura").value = p.altura || "";
      if($("objetivo")) $("objetivo").value = p.objetivo || "";
      if($("nivel")) $("nivel").value = p.nivel || "";
      if($("condicao")) $("condicao").value = p.condicao || "";
      if($("restricao")) $("restricao").value = p.restricao || "";
      if($("termo")) $("termo").checked = true;
    }

    // Foto do prato (demo)
    function wirePlateInput(){
      const btnCam = $("btnCamera");
      const btnGal = $("btnGaleria");
      const fc = $("fileCamera");
      const fg = $("fileGaleria");

      if(btnCam && fc) btnCam.addEventListener("click", ()=> fc.click());
      if(btnGal && fg) btnGal.addEventListener("click", ()=> fg.click());

      function onFile(file){
        if(!file) return;
        const reader = new FileReader();
        reader.onload = ()=>{
          const dataUrl = String(reader.result || "");
          localStorage.setItem(KEY_PLATE, dataUrl);
          showPlate(dataUrl);
        };
        reader.readAsDataURL(file);
      }

      if(fc) fc.addEventListener("change", ()=> onFile(fc.files?.[0]));
      if(fg) fg.addEventListener("change", ()=> onFile(fg.files?.[0]));
    }

    function showPlate(dataUrl){
      const box = $("platePreview");
      const img = $("plateImg");
      if(!box || !img) return;
      img.src = dataUrl;
      box.style.display = "block";
    }

    function loadLastPlate(){
      const dataUrl = localStorage.getItem(KEY_PLATE);
      if(dataUrl) showPlate(dataUrl);
    }

    function analisarPratoDemo(){
      const dataUrl = localStorage.getItem(KEY_PLATE);
      const out = $("plateResult");
      if(!out) return;

      if(!dataUrl){
        out.style.display="block";
        out.textContent = "Envie uma foto primeiro.";
        return;
      }

      // demo simples
      const p = carregarCadastro() || {};
      const objetivo = (p.objetivo || "Manter").toLowerCase();
      let kcal = 650;
      if(objetivo.includes("emag")) kcal = 520;
      if(objetivo.includes("massa")) kcal = 820;

      out.style.display="block";
      out.textContent = `‚úÖ (DEMO) Estimativa: ~${kcal} kcal. Depois ligamos IA real para identificar itens e por√ß√µes.`;
    }
    window.analisarPratoDemo = analisarPratoDemo;

    // Dieta
    const DIETAS_BASE = [
      [
        {t:"Caf√© da manh√£", d:"Omelete de 2 ovos com espinafre + 1 fatia de p√£o integral.", k:350},
        {t:"Lanche da manh√£", d:"Mix de castanhas + 1 ma√ß√£.", k:180},
        {t:"Almo√ßo", d:"Frango grelhado + arroz integral + feij√£o + salada.", k:550},
        {t:"Lanche da tarde", d:"Iogurte natural + 1 colher de chia.", k:160},
        {t:"Jantar", d:"Peixe grelhado + legumes + batata-doce.", k:480},
      ],
      [
        {t:"Caf√© da manh√£", d:"3 ovos + aveia + banana.", k:550},
        {t:"Almo√ßo", d:"Arroz integral + feij√£o + frango + br√≥colis.", k:800},
        {t:"Jantar", d:"Macarr√£o integral + patinho + molho de tomate.", k:750},
        {t:"Ceia", d:"Iogurte + granola.", k:300},
      ],
      [
        {t:"Caf√© da manh√£", d:"Tapioca com queijo + caf√© sem a√ß√∫car.", k:420},
        {t:"Almo√ßo", d:"Carne magra + mandioca + salada.", k:720},
        {t:"Jantar", d:"Omelete + legumes.", k:460},
      ]
    ];

    function carregarDieta(){
      try{ return JSON.parse(localStorage.getItem(KEY_DIETA) || "null"); }catch{ return null; }
    }

    function salvarDieta(d){
      localStorage.setItem(KEY_DIETA, JSON.stringify(d));
    }

    function gerarDieta(){
      const d = DIETAS_BASE[Math.floor(Math.random()*DIETAS_BASE.length)];
      salvarDieta(d);
      renderDieta(d);
    }
    window.gerarDieta = gerarDieta;

    function renderDieta(d){
      const box = $("dietaBox");
      if(!box) return;
      box.innerHTML = "";
      if(!d){
        const s = document.createElement("div");
        s.className="status";
        s.textContent="Gere uma dieta para aparecer aqui.";
        box.appendChild(s);
        return;
      }
      d.forEach(m=>{
        const div = document.createElement("div");
        div.className="meal";
        div.innerHTML = `
          <div>
            <div class="title">${escapeHtml(m.t)}</div>
            <p>${escapeHtml(m.d)}</p>
          </div>
          <div class="kcal">${Number(m.k||0)}<br/>kcal</div>
        `;
        box.appendChild(div);
      });
    }

    // Treino
    const TREINOS = {
      "Academia": [
        ["Segunda", ["Desenvolvimento com halteres","Agachamento livre","Flex√£o de bra√ßos"]],
        ["Quarta", ["Supino reto","Remada curvada","Eleva√ß√£o lateral"]],
        ["Sexta", ["Levantamento terra","Puxada na barra","Abdominal prancha"]],
      ],
      "Corrida": [
        ["Segunda", ["Corrida leve 30 min","Mobilidade de quadril"]],
        ["Quarta", ["Tiros 8x 200m","Alongamento"]],
        ["Sexta", ["Corrida moderada 40 min","Fortalecimento core"]],
      ],
      "Muay Thai":[
        ["Ter√ßa", ["Sombra 10 min","Chutes b√°sicos","Combina√ß√µes 1-2"]],
        ["Quinta", ["Manopla (drills)","Defesas","Condicionamento"]],
        ["S√°bado", ["T√©cnica clinch","Sequ√™ncias","Alongamento"]],
      ],
      "Futebol":[
        ["Segunda", ["Arranque e velocidade","Controle de bola","Finaliza√ß√£o"]],
        ["Quarta", ["Agilidade com cones","Passe e dom√≠nio","Resist√™ncia"]],
        ["Sexta", ["Jogo reduzido","Alongamento"]],
      ],
      "Basquete":[
        ["Ter√ßa", ["Drible (fundamentos)","Arremessos","Pliometria"]],
        ["Quinta", ["Defesa lateral","Bandejas","Condicionamento"]],
        ["S√°bado", ["Treino de jogo","Alongamento"]],
      ]
    };

    function carregarTreino(){
      try{ return JSON.parse(localStorage.getItem(KEY_TREINO) || "null"); }catch{ return null; }
    }
    function salvarTreino(t){
      localStorage.setItem(KEY_TREINO, JSON.stringify(t));
    }

    function gerarTreino(){
      const tema = $("temaTreino")?.value || "Academia";
      const intensidade = $("intTreino")?.value || "Moderado";
      const base = TREINOS[tema] || TREINOS["Academia"];

      const plano = { tema, intensidade, dias: base, createdAt: Date.now() };
      salvarTreino(plano);
      renderTreino(plano);

      const out = $("outTreino");
      if(out){
        out.style.display="block";
        out.textContent = `‚úÖ Treino salvo: ${tema} (${intensidade}).`;
      }
    }
    window.gerarTreino = gerarTreino;

    function limparTreino(){
      localStorage.removeItem(KEY_TREINO);
      if($("treinoSemana")) $("treinoSemana").innerHTML = "";
      const out = $("outTreino");
      if(out){ out.style.display="block"; out.textContent="üßπ Treino removido."; }
    }
    window.limparTreino = limparTreino;

    function renderTreino(t){
      const box = $("treinoSemana");
      if(!box) return;
      box.innerHTML = "";
      if(!t){
        const s = document.createElement("div");
        s.className="status";
        s.textContent="Gere um treino para aparecer aqui.";
        box.appendChild(s);
        return;
      }

      t.dias.forEach(d=>{
        const day = document.createElement("div");
        day.className="dayCard";
        day.innerHTML = `<div class="dayTitle"><span>${escapeHtml(d[0])}</span><span class="muted">${escapeHtml(t.tema)}</span></div>`;
        (d[1]||[]).forEach(ex=>{
          const row = document.createElement("div");
          row.className="exercise";
          const left = document.createElement("div");
          left.innerHTML = `<b>${escapeHtml(ex)}</b><div class="muted" style="font-size:12px; margin-top:4px">${escapeHtml(t.intensidade)}</div>`;
          const btn = document.createElement("button");
          btn.className="ytBtn";
          btn.textContent="Ver t√©cnica";
          btn.addEventListener("click", ()=> openYT(`${ex} como fazer`));
          row.appendChild(left);
          row.appendChild(btn);
          day.appendChild(row);
        });
        box.appendChild(day);
      });
    }

    // Convites / reward (demo)
    function getOrCreateInviteCode(){
      let code = localStorage.getItem(KEY_INV_CODE);
      if(code) return code;
      code = "ELITE-" + Math.random().toString(16).slice(2,8).toUpperCase();
      localStorage.setItem(KEY_INV_CODE, code);
      return code;
    }
    function getMyInviteLink(){
      const code = getOrCreateInviteCode();
      const url = new URL(location.href);
      url.searchParams.set("ref", code);
      return url.toString();
    }

    function getBalance(){ return Number(localStorage.getItem(KEY_BAL) || "0"); }
    function setBalance(v){
      localStorage.setItem(KEY_BAL, String(v));
      renderInviteUI();
    }
    window.getBalance = getBalance;
    window.setBalance = setBalance;

    async function copyInviteLink(){
      const link = getMyInviteLink();
      try{
        await navigator.clipboard.writeText(link);
        alert("‚úÖ Link copiado!");
      }catch{
        prompt("Copie o link:", link);
      }
    }
    window.copyInviteLink = copyInviteLink;

    function shareInvite(){
      const link = getMyInviteLink();
      const text = `Baixa o Confira o Prato Elite e usa meu link: ${link}`;
      if(navigator.share){
        navigator.share({ title:"Confira o Prato Elite", text, url: link }).catch(()=>{});
      }else{
        copyInviteLink();
      }
    }
    window.shareInvite = shareInvite;

    function renderInviteUI(){
      const code = getOrCreateInviteCode();
      const link = getMyInviteLink();
      const bal = getBalance();
      const falta = Math.max(0, 50 - bal);

      if($("myCode")) $("myCode").textContent = code;
      if($("myLink")) $("myLink").textContent = link;

      if($("balTxt")){
        $("balTxt").textContent = new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(bal);
      }
      if($("progressTxt")){
        $("progressTxt").textContent = bal >= 50
          ? "‚úÖ Voc√™ atingiu R$ 50! (Saque via Pix/QR ser√° ativado quando ligarmos o sistema.)"
          : `Faltam ${new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(falta)} para atingir R$ 50.`;
      }
    }

    // escape
    function escapeHtml(s){
      return String(s).replace(/[&<>"]/g, m => ({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;" }[m]));
    }

    // init
    function init(){
      wireNav();
      aplicarCadastroNaTela();
      buildSportsChips();

      wirePlateInput();
      loadLastPlate();

      // dieta / treino salvos
      renderDieta(carregarDieta());
      renderTreino(carregarTreino());

      // premium button text
      const btn = $("btnPremium");
      if(btn){
        btn.textContent = `CONFIRMAR R$ ${PREMIUM_PRICE.toFixed(2).replace(".", ",")}/M√äS`;
      }

      renderInviteUI();
    }

    init();
    function scrollToTop(){
  const active = document.querySelector(".screen.active");
  if(active){
    active.scrollTo({ top:0, behavior:"smooth" });
  }
}
window.scrollToTop = scrollToTop;

function updateTopBtn(){
  const active = document.querySelector(".screen.active");
  const btn = document.getElementById("btnTop");
  if(!active || !btn) return;
  btn.style.display = active.scrollTop > 200 ? "block" : "none";
}
document.addEventListener("scroll", updateTopBtn, true);
document.querySelectorAll(".screen").forEach(s => {
  s.addEventListener("scroll", updateTopBtn);
});
  </script>
  <button id="btnTop" onclick="scrollToTop()" style="
position:fixed;
bottom:110px;
right:18px;
width:48px;
height:48px;
border-radius:50%;
border:none;
background:linear-gradient(135deg,#21e6b6,#17caa0);
color:#042019;
font-size:22px;
font-weight:900;
box-shadow:0 10px 25px rgba(0,0,0,.4);
display:none;
z-index:999;
cursor:pointer;">
‚Üë
  </button>
</body>
</html>
